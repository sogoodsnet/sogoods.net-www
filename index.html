<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>sogoods.net - Faithful Recreation</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Times New Roman', serif;
            background: #f5f5f5;
            color: #000;
            line-height: 1.4;
            overflow-x: hidden;
        }

        /* ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒŠ - 3ã‚«ãƒ©ãƒ ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆï¼ˆç«¯æœ«é«˜ã•100%å¯¾å¿œï¼‰ */
        .main-container {
            display: grid;
            grid-template-columns: 280px 1fr 280px;
            height: 100vh;
            max-height: none;
            min-height: 100vh;
            background: #f5f5f5;
            position: relative;
            overflow: hidden;
        }

        /* å·¦ã‚«ãƒ©ãƒ  - ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒªã‚¢ */
        .left-column {
            background: #f5f5f5;
            padding: 40px 20px 20px 20px;
            position: relative;
            overflow-y: auto;
            height: 100%;
        }

        /* ãƒ­ã‚´ã‚¨ãƒªã‚¢ */
        .logo {
            width: 110px;
            height: 80px;
            margin-bottom: 30px;
            background: transparent;
            color: #000;
            display: flex;
            align-items: center;
            justify-content: flex-start;
            font-family: Arial, sans-serif;
            font-size: 24px;
            font-weight: 900;
            letter-spacing: -1px;
        }
        
        .logo img {
            width: auto;
            height: auto;
            max-width: 110px;
            max-height: 80px;
            object-fit: contain;
        }

        /* SOGOODS.NETãƒ†ã‚­ã‚¹ãƒˆ - ä½ç½®ã‚’å°‘ã—ä¸‹ã« */
        .extr-text {
            font-size: 48px;
            font-weight: 900;
            color: #000;
            margin: 35px 0 20px 0; /* ä¸Šãƒãƒ¼ã‚¸ãƒ³ã‚’15pxâ†’35pxã€ä¸‹ãƒãƒ¼ã‚¸ãƒ³20pxã«å¤‰æ›´ */
            font-family: Arial, sans-serif;
            letter-spacing: -4px;
            line-height: 0.8;
            text-transform: uppercase;
            word-break: break-all;
        }

        /* ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒ­ã‚´ã‚¨ãƒªã‚¢ */
        .menu-logos {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 25px;
            padding: 0;
        }

        /* ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒœã‚¿ãƒ³å…±é€šã‚¹ã‚¿ã‚¤ãƒ« */
        .menu-btn {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 8px 12px;
            background: linear-gradient(135deg, #2196F3 0%, #1976D2 100%);
            color: white;
            text-decoration: none;
            border-radius: 20px;
            font-size: 11px;
            font-weight: bold;
            font-family: Arial, sans-serif;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(33, 150, 243, 0.3);
            border: none;
            cursor: pointer;
        }

        .menu-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(33, 150, 243, 0.5);
            background: linear-gradient(135deg, #1976D2 0%, #1565C0 100%);
        }

        .menu-btn:active {
            transform: translateY(0);
        }

        /* MAPSç”»åƒãƒœã‚¿ãƒ³ã®ã‚¹ã‚¿ã‚¤ãƒ« - ã‚¯ãƒªãƒ¼ãƒ³ã§é€éãƒ­ã‚´ã«æœ€é© */
        .maps-img-btn {
            display: inline-block;
            padding: 2px;
            background: none;
            border: none;
            transition: all 0.3s ease;
            text-decoration: none;
            opacity: 0.8;
        }

        .maps-img-btn:hover {
            transform: translateY(-2px) scale(1.05);
            opacity: 1;
            filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.15));
        }

        .maps-img-btn:active {
            transform: translateY(0);
        }

        .maps-img {
            display: block;
            width: auto;
            height: 32px; /* é©åˆ‡ãªã‚µã‚¤ã‚ºã«èª¿æ•´ */
            max-width: 100%;
            object-fit: contain;
        }

        /* æ—§CSSãƒœã‚¿ãƒ³ã‚¹ã‚¿ã‚¤ãƒ«ï¼ˆäºˆå‚™ï¼‰ */
        .btn-icon {
            font-size: 14px;
            display: flex;
            align-items: center;
        }

        .btn-text {
            font-size: 10px;
            font-weight: bold;
        }

        /* å·¦å´ã®ãƒ†ã‚­ã‚¹ãƒˆãƒ–ãƒ­ãƒƒã‚¯ - ãƒ•ã‚©ãƒ³ãƒˆã‚µã‚¤ã‚ºã‚’å°‘ã—å¤§ãã */
        .text-content {
            font-size: 12px;
            line-height: 1.3;
            color: #333;
            text-align: justify;
            font-family: 'Times New Roman', serif;
        }

        .text-content p {
            margin-bottom: 8px;
        }

        /* ãƒ­ã‚´ã‚¨ãƒªã‚¢ - å·¦ä¸Šã«ç§»å‹• */
        .logo-circle-left {
            position: absolute;
            width: 60px;
            height: 60px;
            top: 10px;
            left: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            opacity: 1;
            transform: scale(1);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 100;
        }

        .logo-circle-left img {
            width: 60px;
            height: 60px;
            object-fit: contain;
        }

        .logo-circle-left:hover {
            transform: scale(1.1);
        }

        .logo-circle-left.disappearing {
            opacity: 0;
            transform: scale(0) rotate(360deg);
            transition: all 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }

        /* ä¸­å¤®ã‚«ãƒ©ãƒ  - ãƒ¡ã‚¤ãƒ³ç”»åƒ */
        .center-column {
            background: #fff;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }

        .main-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            object-position: center center;
            filter: grayscale(100%) contrast(1.2);
            transition: all 0.5s ease;
            display: block;
            background: #f5f5f5;
        }

        /* æ•°å­—ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ */
        .numbers-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            pointer-events: none;
        }

        .number {
            position: absolute;
            background: rgba(255, 255, 255, 0.9);
            color: #000;
            padding: 4px 8px;
            font-family: Arial, sans-serif;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            pointer-events: auto;
            user-select: none;
            opacity: 0;
            transform: scale(0.5) translateY(20px);
        }

        /* æ•°å­—ã®ãƒ©ãƒ³ãƒ€ãƒ æµ®ä¸Šã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
        .number.floating {
            opacity: 1;
            transform: scale(1) translateY(0);
            transition: all 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }

        .number.disappearing {
            opacity: 0;
            transform: scale(0.5) translateY(-20px);
            transition: all 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }

        @keyframes numberFloat {
            0% { 
                opacity: 0;
                transform: scale(0.5) translateY(20px);
            }
            30% {
                opacity: 0.7;
                transform: scale(1.05) translateY(-3px);
            }
            60% {
                opacity: 1;
                transform: scale(1.02) translateY(-1px);
            }
            100% { 
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }

        @keyframes numberFade {
            0% { 
                opacity: 1;
                transform: scale(1) translateY(0);
            }
            40% { 
                opacity: 0.8;
                transform: scale(0.98) translateY(-3px);
            }
            100% { 
                opacity: 0;
                transform: scale(0.5) translateY(-15px);
            }
        }

        .number:hover {
            background: rgba(33, 150, 243, 0.9);
            color: white;
            transform: scale(1.1);
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }

        .number.tanka-mode {
            background: rgba(33, 150, 243, 0.95);
            color: white;
            padding: 8px 12px;
            font-size: 10px;
            line-height: 1.3;
            min-width: 120px;
            white-space: pre-line;
            text-align: center;
            border-radius: 4px;
            transform: scale(1.05);
            z-index: 10;
        }

        .number.grabbed {
            animation: grabEffect 0.5s ease-out;
            z-index: 100;
        }

        @keyframes grabEffect {
            0% { transform: scale(1); }
            50% { transform: scale(1.3) rotate(5deg); }
            100% { transform: scale(1) rotate(0deg); }
        }
            border-radius: 3px;
            font-size: 14px;
        }

        /* æ•°å­—ã®å€‹åˆ¥é…ç½® */
        .n1 { top: 50px; left: 60px; }
        .n2 { top: 80px; right: 80px; }
        .n3 { top: 120px; left: 40px; }
        .n4 { top: 140px; right: 120px; }
        .n5 { top: 180px; left: 80px; }
        .n6 { top: 200px; right: 60px; }
        .n7 { top: 240px; left: 100px; }
        .n8 { top: 260px; right: 100px; }
        .n9 { top: 300px; left: 50px; }
        .n10 { top: 320px; right: 90px; }
        .n11 { top: 360px; left: 120px; }
        .n12 { top: 380px; right: 50px; }
        .n13 { top: 420px; left: 70px; }
        .n14 { top: 440px; right: 110px; }
        .n15 { top: 480px; left: 90px; }
        .n16 { top: 500px; right: 70px; }
        .n17 { bottom: 180px; left: 110px; }
        .n18 { bottom: 160px; right: 80px; }
        .n19 { bottom: 140px; left: 60px; }
        .n20 { bottom: 120px; right: 120px; }
        .n21 { bottom: 100px; left: 140px; }
        .n22 { bottom: 80px; right: 40px; }
        .n23 { bottom: 60px; left: 80px; }
        .n24 { bottom: 40px; right: 100px; }

        /* é’ã„ç„¡é™å¤§è¨˜å· */
        .infinity-symbol {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 180px;
            color: #2196F3;
            font-weight: bold;
            font-family: Arial, sans-serif;
            z-index: 10;
        }

        /* å³ã‚«ãƒ©ãƒ  - TIIã‚»ã‚¯ã‚·ãƒ§ãƒ³ */
        .right-column {
            background: #666;
            color: #fff;
            padding: 20px;
            position: relative;
            overflow-y: auto;
            height: 100%;
        }

        .news-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
        }

        .blue-circle-news {
            width: 40px;
            height: 40px;
            background: #2196F3;
            border-radius: 50%;
            margin-right: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            opacity: 1;
            transform: scale(1);
        }

        .blue-circle-news:hover {
            transform: scale(1.1);
            box-shadow: 0 0 15px rgba(33, 150, 243, 0.5);
        }

        .blue-circle-news.disappearing {
            opacity: 0;
            transform: scale(0) rotate(360deg);
            transition: all 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }

        .news-title {
            font-size: 32px;
            font-weight: bold;
            color: #fff;
            font-family: Arial, sans-serif;
        }

        .news-content {
            font-size: 11px;
            line-height: 1.4;
            color: #fff;
            text-align: justify;
            font-family: 'Times New Roman', serif;
        }

        .news-content p {
            margin-bottom: 10px;
        }

        /* é’ã„å†† - å³ä¸‹ */
        .blue-circle-bottom {
            position: absolute;
            width: 80px;
            height: 80px;
            background: #2196F3;
            border-radius: 50%;
            bottom: 100px;
            right: 40px;
            cursor: pointer;
            transition: all 0.3s ease;
            opacity: 1;
            transform: scale(1);
        }

        .blue-circle-bottom:hover {
            transform: scale(1.1);
            box-shadow: 0 0 25px rgba(33, 150, 243, 0.5);
        }

        .blue-circle-bottom.disappearing {
            opacity: 0;
            transform: scale(0) rotate(360deg);
            transition: all 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }


            box-shadow: 0 4px 12px rgba(33, 150, 243, 0.3);
        }

        /* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ãƒ‡ã‚¶ã‚¤ãƒ³ */
        @media (max-width: 1024px) {
            .main-container {
                grid-template-columns: 1fr;
                grid-template-rows: minmax(280px, 1fr) minmax(350px, auto) minmax(280px, 1fr);
                height: 100vh;
                max-height: none;
                min-height: 100vh;
            }
            
            .infinity-symbol {
                font-size: 120px;
            }
            
            .center-column {
                height: 350px;
            }
            
            .left-column, .right-column {
                height: auto;
                min-height: 280px;
                overflow-y: auto;
                padding: 20px;
                box-sizing: border-box;
            }
        }

        @media (max-width: 768px) {
            .main-container {
                grid-template-rows: minmax(320px, 1fr) minmax(300px, auto) minmax(320px, 1fr);
                height: 100vh;
                min-height: 100vh;
            }
            
            .infinity-symbol {
                font-size: 80px;
            }
            
            .number {
                font-size: 12px;
                padding: 3px 6px;
            }
            
            .center-column {
                height: 300px;
            }
            
            .left-column, .right-column {
                height: auto;
                min-height: 320px;
                padding: 20px 15px;
            }
            
            .extr-text {
                font-size: 32px;
            }
            
            /* ãƒ¢ãƒã‚¤ãƒ«ç”¨ãƒ­ã‚´èª¿æ•´ */
            .logo-circle-left {
                width: 50px;
                height: 50px;
                top: 5px;
                left: 5px;
            }
            
            .logo-circle-left img {
                width: 50px;
                height: 50px;
            }
            
            .text-content {
                font-size: 14px;
                line-height: 1.5;
            }
            
            .diary-content {
                font-size: 14px;
                line-height: 1.5;
            }
        }

        /* é«˜è§£åƒåº¦ãƒ‡ã‚£ã‚¹ãƒ—ãƒ¬ã‚¤ç”¨ */
        @media (min-height: 900px) {
            .main-container {
                height: 100vh;
                min-height: 100vh;
            }
        }

        /* å°ã•ãªã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³ç”¨ */
        @media (max-width: 480px) {
            .main-container {
                grid-template-rows: minmax(360px, 1fr) minmax(280px, auto) minmax(360px, 1fr);
                height: 100vh;
                min-height: 100vh;
            }
            
            .left-column, .right-column {
                min-height: 360px;
                padding: 20px 10px;
            }
            
            .center-column {
                height: 280px;
            }
            
            .extr-text {
                font-size: 28px;
                margin-bottom: 15px;
            }
            
            .text-content, .diary-content {
                font-size: 13px;
                line-height: 1.4;
            }
            
            .logo {
                margin-bottom: 20px;
            }
        }

        /* ä½è§£åƒåº¦ãƒ‡ã‚£ã‚¹ãƒ—ãƒ¬ã‚¤ç”¨ */
        @media (max-height: 600px) {
            .main-container {
                height: 100vh;
                min-height: 100vh;
            }
            
            .left-column, .right-column {
                min-height: 200px;
                font-size: 14px;
            }
            
            .extr-text {
                font-size: 36px;
            }
        }

        /* ğŸ­ ç¸¦æ›¸ãçŸ­æ­Œãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã‚¹ã‚¿ã‚¤ãƒ« */
        .tanka-popup {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            z-index: 10000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }

        .tanka-popup.show {
            opacity: 1;
            visibility: visible;
        }

        .tanka-popup-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1;
        }

        .tanka-popup-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(255, 255, 255, 0.98);
            border-radius: 18px;
            padding: 30px 40px;
            min-width: 320px;
            min-height: 360px;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(0, 0, 0, 0.1);
            text-align: center;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 2;
        }

        .tanka-close-btn {
            position: absolute;
            top: 10px;
            right: 15px;
            font-size: 20px;
            cursor: pointer;
            color: #666;
            transition: color 0.2s ease;
            font-weight: bold;
            width: 25px;
            height: 25px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .tanka-close-btn:hover {
            color: #333;
            background: rgba(0, 0, 0, 0.1);
            border-radius: 50%;
        }

        /* ç¸¦æ›¸ããƒ†ã‚­ã‚¹ãƒˆ */
        .tanka-vertical-text {
            writing-mode: vertical-rl;
            text-orientation: upright;
            font-family: 'Noto Serif JP', 'Times New Roman', serif;
            font-size: 18px;
            line-height: 1.4;
            color: #222;
            margin: 15px 0;
            padding: 15px;
            min-height: 120px;
            display: flex;
            align-items: center;
            justify-content: center;
            letter-spacing: 0.05em;
            font-weight: 500;
            text-shadow: 0 0 1px rgba(0, 0, 0, 0.1);
        }

        .vertical-char {
            display: inline-block;
            text-align: center;
        }

        /* çŸ­æ­Œè§£èª¬ */
        .tanka-commentary {
            margin: 20px 0;
            font-size: 14px;
            line-height: 1.6;
            color: #555;
            text-align: left;
            font-family: 'Noto Sans JP', Arial, sans-serif;
            background: rgba(240, 240, 240, 0.5);
            padding: 15px 18px;
            border-radius: 10px;
            border-left: 3px solid #2196F3;
            max-width: 260px;
            font-style: italic;
        }

        /* æŠ•ç¥¨ãƒœã‚¿ãƒ³ - åˆæœŸçŠ¶æ…‹ã¯ã‚°ãƒ¬ãƒ¼ã‚¹ã‚±ãƒ¼ãƒ« */
        .tanka-voting {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .vote-btn {
            background: linear-gradient(135deg, #888 0%, #666 100%);
            color: #ccc;
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 12px;
            font-weight: bold;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 6px;
            min-width: 80px;
            justify-content: center;
            filter: grayscale(100%);
        }

        .vote-btn:hover {
            transform: translateY(-2px);
            filter: grayscale(0%);
            color: white;
        }

        .like-btn {
            background: linear-gradient(135deg, #888 0%, #666 100%);
        }

        .like-btn:hover {
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            box-shadow: 0 5px 15px rgba(76, 175, 80, 0.4);
        }

        .dislike-btn {
            background: linear-gradient(135deg, #888 0%, #666 100%);
        }

        .dislike-btn:hover {
            background: linear-gradient(135deg, #f44336 0%, #d32f2f 100%);
            box-shadow: 0 5px 15px rgba(244, 67, 54, 0.4);
        }

        .vote-btn.voted {
            animation: voteAnimation 0.3s ease-out;
        }

        @keyframes voteAnimation {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        .vote-count {
            background: rgba(255, 255, 255, 0.2);
            padding: 2px 6px;
            border-radius: 10px;
            font-size: 12px;
            min-width: 20px;
        }



        /* ğŸ“ TII Database Styles */
        .tii-write-area {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 12px;
            margin-bottom: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        #tii-input {
            width: 100%;
            height: 80px;
            background: rgba(255, 255, 255, 0.9);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 8px;
            padding: 10px;
            font-size: 12px;
            font-family: 'Times New Roman', serif;
            resize: vertical;
            color: #333;
        }

        #tii-input:focus {
            outline: none;
            border-color: #2196F3;
            background: rgba(255, 255, 255, 0.95);
        }

        .tii-meta {
            display: flex;
            gap: 8px;
            margin-top: 8px;
        }

        #tii-author {
            flex: 1;
            background: rgba(255, 255, 255, 0.8);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 6px;
            padding: 6px 8px;
            font-size: 11px;
            color: #333;
        }

        #tii-author:focus {
            outline: none;
            border-color: #2196F3;
            background: rgba(255, 255, 255, 0.9);
        }

        #tii-submit {
            background: linear-gradient(135deg, #2196F3 0%, #1976D2 100%);
            color: white;
            border: none;
            border-radius: 6px;
            padding: 6px 12px;
            font-size: 11px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        #tii-submit:hover {
            transform: translateY(-1px);
            box-shadow: 0 3px 8px rgba(33, 150, 243, 0.4);
        }

        #tii-submit:active {
            transform: translateY(0);
        }

        .tii-entries {
            max-height: 300px;
            overflow-y: auto;
            scrollbar-width: thin;
            scrollbar-color: rgba(255, 255, 255, 0.3) transparent;
        }

        .tii-entries::-webkit-scrollbar {
            width: 4px;
        }

        .tii-entries::-webkit-scrollbar-track {
            background: transparent;
        }

        .tii-entries::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.3);
            border-radius: 2px;
        }

        .tii-entry {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 10px;
            margin-bottom: 8px;
            font-size: 10px;
            line-height: 1.4;
            color: #fff;
        }

        .tii-entry-content {
            margin-bottom: 6px;
            word-wrap: break-word;
        }

        .tii-entry-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 9px;
            color: rgba(255, 255, 255, 0.7);
        }

        .tii-entry-author {
            font-weight: bold;
        }

        .tii-entry-time {
            font-family: 'Courier New', monospace;
        }

        .tii-loading {
            text-align: center;
            color: rgba(255, 255, 255, 0.7);
            font-size: 10px;
            padding: 20px;
        }

        .tii-error {
            background: rgba(244, 67, 54, 0.1);
            border: 1px solid rgba(244, 67, 54, 0.3);
            color: #ff6b6b;
            padding: 10px;
            border-radius: 6px;
            font-size: 10px;
            text-align: center;
        }

        /* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œ */
        @media (max-width: 768px) {
            .tanka-popup-content {
                padding: 25px 30px;
                min-width: 280px;
                margin: 0 20px;
                min-height: 320px;
            }
            
            .tanka-vertical-text {
                font-size: 16px;
                min-height: 100px;
                margin: 12px 0;
                padding: 12px;
            }
            
            .tanka-voting {
                flex-direction: column;
                gap: 8px;
            }

            .vote-btn {
                padding: 6px 12px;
                font-size: 11px;
                min-width: 70px;
            }

            .tanka-commentary {
                font-size: 13px;
                padding: 12px 15px;
                max-width: 220px;
            }

            .tii-write-area {
                padding: 12px;
            }

            #tii-input {
                height: 60px;
                font-size: 11px;
            }

            .tii-entries {
                max-height: 200px;
            }

            /* ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒœã‚¿ãƒ³ã®ãƒ¢ãƒã‚¤ãƒ«å¯¾å¿œ */
            .menu-logos {
                gap: 6px;
                margin-bottom: 20px;
            }

            .menu-btn {
                padding: 6px 10px;
                font-size: 10px;
                border-radius: 15px;
            }

            .maps-img-btn {
                padding: 1px;
            }

            .maps-img {
                height: 28px; /* ãƒ¢ãƒã‚¤ãƒ«ã§ã¯å°‘ã—å°ã•ã */
            }

            .btn-icon {
                font-size: 12px;
            }

            .btn-text {
                font-size: 9px;
            }

            .extr-text {
                font-size: 42px;
                margin: 25px 0 15px 0;
            }
        }
    </style>
    <!-- é™çš„å†™çœŸãƒªã‚¹ãƒˆ -->
    <script src="/photos/photo-list.js"></script>
</head>
<body>
    <div class="main-container">
        <!-- å·¦ã‚«ãƒ©ãƒ  -->
        <div class="left-column">
            <!-- å·¦ä¸Šã®ãƒ­ã‚´ã‚’å‰Šé™¤ï¼ˆé’ã„ä¸¸ãŒãƒ­ã‚´ä»£ã‚ã‚Šã«ï¼‰ -->
            
            <div class="extr-text">SOGOODS.NET</div>
            
            <!-- ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒ­ã‚´ã‚¨ãƒªã‚¢ -->
            <div class="menu-logos">
                <a href="https://www.google.com/maps/contrib/110888846867377060754/photos/@45.8829971,54.1250407,3z/data=!3m1!4b1!4m3!8m2!3m1!1e2?entry=ttu&g_ep=EgoyMDI1MDkyNC4wIKXMDSoASAFQAw%3D%3D" target="_blank" class="maps-img-btn">
                    <img src="/img/button/maps.png" alt="Maps" class="maps-img" />
                </a>
            </div>
            
            <div class="text-content">
                <p>æš®ã‚‰ã— è³ªç´ ã§ã‚‚è‰¯ã„ã€‚ä½ã¾ã„ã¯åºƒã™ããšã€æŠ€è¡“ã¯æœ€æ–°ã®ã‚‚ã®ã‚’å–ã‚Šå…¥ã‚Œã€é“å…·ã¯é•·ãä½¿ãˆã¦æ„›ç€ãŒã‚ã‚Šã€ç¤¾ä¼šã¨ã¯æŠ•è³‡ã‚’é€šã˜ã¦é–¢ã‚ã‚Šã€ä»•äº‹ã‚’é€šã—ã¦æ¥ã™ã‚‹ã€‚</p>
                
                <p>äººç”Ÿã®åŠåˆ†ã¯ã€èª°ã‹ã«æ­¢ã‚ã‚‰ã‚ŒãŸã£ã¦ã—ãŸã„äº‹ã‚’ã—ã€æ®‹ã‚Šã®åŠåˆ†ã¯ã€ã‚‚ã£ã¨ã—ãŸãã¦ã—ã‚‡ã†ãŒãªã„äº‹ã‚’ã™ã‚‹ç‚ºã«ã‚ã‚‹ã€‚</p>
                
                <p>è‡ªç„¶ã®ä¸­ã«ç¾ã—ã•ã‚’è¦‹ã„ã ã—ã€æ€ã„å‡ºã®ä¸­ã«æ¥½ã—ã•ã‚’ä»•èˆã„ã€å¸Œæœ›ã®ä¸­ã«å¤¢ã‚’æãã€ç¾å®Ÿã®ä¸­ã«å…‰ã‚’æ¢ã™ã€‚ç§ãŸã¡ãŒã€é£Ÿã¹ãŸã„ã¨æ€ãˆã‚‹ã‚‚ã®ã‚’é£Ÿã¹ã€ã‚ãªãŸã¨å…±ã«ã€ç¾å‘³ã—ã„é£Ÿå“ã«ã¤ãã€å·¥å¤«ã‚’ã“ã‚‰ã—ã€ã‚·ãƒ³ãƒ—ãƒ«ã«ã‚†ãç€ãã€‚</p>
                
                <p>è‡ªåˆ†ãŸã¡ã®è€ƒãˆæ–¹ã‚„æ„Ÿæ€§ã‚’ç™ºä¿¡ã—ã€å¿«é©ãªç¡çœ ã‚’ã¨ã‚Šã€è¡ŒããŸã„ã¨ã“ã‚ã«è‡ªç”±ã«è¡Œã‘ã€æ—…ã‚’é€šã˜ã¦ä¸–ç•Œã‚’çŸ¥ã‚Šã€ä¸–ç•Œã‚’é€šã˜ã¦ã€æ—¥æœ¬ã‚’çŸ¥ã‚‹ã€‚å››å­£ã‚’æ„Ÿã˜ã‚‹ä½ã¾ã„ã«ã™ã¿ã€éƒ½ä¼šã®ä¸­ã§ã‚‚ãªãã€è‡ªç„¶ã®ä¸­ã§ã‚‚ãªã„ã€çµ¶ãˆãšå­¦ã³ã®ä¸­ã«èº«ã‚’æŠ•ã˜ã€æƒ…å ±ã®æ´ªæ°´ã‹ã‚‰ã€ä¸€æ¯ã®æ¸…æ°´ã‚’ã™ãã†ã€‚</p>
                
                <p>ç–å¤–ã•ã‚Œã‚‹äº‹ç„¡ãã€ã™ã‚‹äº‹ç„¡ãã€å·®åˆ¥ã‚’å—ã‘ã‚‹äº‹ãªãã€å·®åˆ¥ã‚’ã™ã‚‹äº‹ãªãã€å¾Œã‚æŒ‡ã‚’æŒ‡ã•ã‚Œã‚‹äº‹ãªãã€æŒ‡ã™ã“ã¨ã‚’ã›ãšã€æ€æƒ³ã€ä¿¡æ¡ã€èº«åˆ†ã‚’éš ã™äº‹ãªãã€æ¸…å»‰æ½”ç™½ã®ä¸­åº¸ã§åœ¨ã‚ŠãŸã„ã€‚</p>
                
                <p>èª°ã‹ã«æ‹ã‚’ã—ã¦ã€èª°ã‹ã‚’æ„›ã—ã¦ã€èª°ã‹ã‹ã‚‰å¥½ã‹ã‚Œã¦ã€æ„›ã•ã‚Œã¦ã€æ±ºã—ã¦ä¸€äººã§ã¯ãªãã€å…±æ„Ÿã§ãã‚‹å®¶æ—ãŒã„ã¦ã€å­ä¾›ã®è€ƒãˆæ–¹ã«æ„Ÿå‹•ã—ã€ç„¡é™ã®å¯èƒ½æ€§ã‚’æ„Ÿã˜ã€ãã‚Œã“ããŒã€ç”Ÿãã‚‹ç†ç”±ãªã®ã‹ã‚‚ã—ã‚Œãªã„ã¨æ€ã†ã€‚</p>
                
                <p>ä¸‡ãŒä¸€ã€æ˜æ—¥æ­»ã‚“ã§ã‚‚æœªç·´ã¯ã‚ã‚‹ã ã‚ã†ãŒã€ä»Šã¾ã§ã®é‹å‘½ã‚’å—ã‘å…¥ã‚Œã¦ã€è‰¯ã‹ã£ãŸã¨æ€ãˆã‚‹åƒ•ã§ã„ãŸã„ã€‚ãã†ã‚„ã£ã¦ã€ç”Ÿãã¦ã‚†ã‘ã‚‹æ§˜ãªç§é”ã§ã‚ã‚ŠãŸã„ã€‚</p>
            </div>
            
            <div class="logo-circle-left">
                <img src="https://sogoods.net/img/logo.png" alt="sogoods.net logo" />
            </div>
        </div>

        <!-- ä¸­å¤®ã‚«ãƒ©ãƒ  -->
        <div class="center-column">
            <!-- Original cat photo removed as requested -->
            
            <div class="infinity-symbol">âˆ</div>
            
            <div class="numbers-overlay">
                <div class="number n1">8</div>
                <div class="number n2">2</div>
                <div class="number n3">4</div>
                <div class="number n4">94</div>
                <div class="number n5">81</div>
                <div class="number n6">51</div>
                <div class="number n7">41</div>
                <div class="number n8">4</div>
                <div class="number n9">1078</div>
                <div class="number n10">27</div>
                <div class="number n11">61</div>
                <div class="number n12">54</div>
                <div class="number n13">20</div>
                <div class="number n14">33</div>
                <div class="number n15">91</div>
                <div class="number n16">7</div>
                <div class="number n17">11</div>
                <div class="number n18">19</div>
                <div class="number n19">5</div>
                <div class="number n20">37</div>
                <div class="number n21">15</div>
                <div class="number n22">17</div>
                <div class="number n23">2</div>
                <div class="number n24">47</div>
            </div>
            
            <!-- ãƒ¡ã‚¤ãƒ³ç”»åƒã‚¨ãƒªã‚¢ -->
            <img src="" alt="Main Image" class="main-image" id="main-image" />
        </div>

        <!-- å³ã‚«ãƒ©ãƒ  -->
        <div class="right-column">
            <div class="news-header">
                <div class="blue-circle-news"></div>
                <div class="news-title">TII</div>
            </div>
            
            <div class="news-content" id="tii-content">
                <!-- TII Database Content -->
                <div class="tii-write-area">
                    <textarea id="tii-input" placeholder="ä»Šã®æ°—æŒã¡ã‚„è€ƒãˆã‚’æ›¸ã„ã¦ãã ã•ã„..." maxlength="500"></textarea>
                    <div class="tii-meta">
                        <input type="text" id="tii-author" placeholder="åå‰ï¼ˆä»»æ„ï¼‰" maxlength="20">
                        <button id="tii-submit">æŠ•ç¨¿</button>
                    </div>
                </div>
                
                <div class="tii-entries" id="tii-entries">
                    <!-- ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãŒå‹•çš„ã«èª­ã¿è¾¼ã¾ã‚Œã¾ã™ -->
                </div>
            </div>
            
            <div class="blue-circle-bottom"></div>
        </div>
    </div>

    <!-- ğŸ“· Integrated JavaScript (Combined for Cloudflare Pages) -->
    <script>
    // =============================================================================
    // NOTION API INTEGRATION
    // =============================================================================
    
    /**
     * Notion APIé€£æºãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«
     * è¨˜äº‹ãƒ»æ—¥è¨˜ãƒ»çŸ­æ­Œã‚’å–å¾—ã—ã¦è¡¨ç¤º
     */
    
    class NotionAPI {
        constructor(config = {}) {
            this.config = {
                // Notion APIè¨­å®šï¼ˆå¾Œã§è¨­å®šï¼‰
                notionToken: config.notionToken || '',
                databaseId: config.databaseId || '',
                corsProxy: config.corsProxy || 'https://cors-anywhere.herokuapp.com/',
                // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ç”¨ã®ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿
                useFallback: config.useFallback !== false
            };
        }
    
        /**
         * Notionãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‹ã‚‰è¨˜äº‹ã‚’å–å¾—
         */
        async fetchArticles(limit = 10) {
            if (!this.config.notionToken || !this.config.databaseId) {
                console.log('Notion APIãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚');
                return this.getFallbackData();
            }
    
            try {
                const response = await fetch(`${this.config.corsProxy}https://api.notion.com/v1/databases/${this.config.databaseId}/query`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${this.config.notionToken}`,
                        'Content-Type': 'application/json',
                        'Notion-Version': '2022-06-28'
                    },
                    body: JSON.stringify({
                        page_size: limit,
                        sorts: [{
                            property: 'Created',
                            direction: 'descending'
                        }]
                    })
                });
    
                if (!response.ok) {
                    throw new Error(`Notion API Error: ${response.status}`);
                }
    
                const data = await response.json();
                return this.processNotionData(data.results);
            } catch (error) {
                console.error('Notion APIå–å¾—ã‚¨ãƒ©ãƒ¼:', error);
                return this.getFallbackData();
            }
        }
    
        /**
         * Notionãƒ‡ãƒ¼ã‚¿ã‚’å‡¦ç†ã—ã¦è¡¨ç¤ºç”¨ã«å¤‰æ›
         */
        processNotionData(results) {
            return results.map(page => {
                const properties = page.properties;
                
                return {
                    id: page.id,
                    title: this.extractText(properties.Title || properties.Name),
                    content: this.extractText(properties.Content || properties.Excerpt),
                    date: this.extractDate(properties.Date || properties.Created),
                    type: this.extractSelect(properties.Type) || 'article',
                    tags: this.extractMultiSelect(properties.Tags),
                    url: page.url
                };
            });
        }
    
        /**
         * ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ç”¨ã®ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿
         */
        getFallbackData() {
            const today = new Date();
            return [
                {
                    id: '1',
                    title: 'æ–°ä½œå†™çœŸå±•ã®ãŠçŸ¥ã‚‰ã›',
                    content: 'ç§‹ã®é¢¨æ™¯ã‚’ãƒ†ãƒ¼ãƒã«ã—ãŸå†™çœŸå±•ã‚’é–‹å‚¬ã—ã¾ã™ã€‚è‡ªç„¶ã®ç¾ã—ã•ã¨å­£ç¯€ã®ç§»ã‚ã„ã‚’è¡¨ç¾ã—ãŸä½œå“ã‚’ãŠæ¥½ã—ã¿ãã ã•ã„...',
                    date: this.formatDate(today),
                    type: 'news',
                    tags: ['å†™çœŸå±•', 'ç§‹']
                },
                {
                    id: '2',
                    title: 'é¢¨ã®ã†ãŸ',
                    content: 'é¢¨æ¶¼ã—\\nå±±ã‚‚ã¿ã˜è‘‰ã®\\nèˆã„è¸Šã‚Š\\nãƒ¬ãƒ³ã‚ºã«æ˜ ã‚‹\\nå­£ç¯€ã®ã—ã‚‰ã¹',
                    date: this.formatDate(new Date(today.getTime() - 5 * 24 * 60 * 60 * 1000)),
                    type: 'tanka',
                    tags: ['çŸ­æ­Œ', 'è‡ªç„¶']
                },
                {
                    id: '3',
                    title: 'æ’®å½±æ—¥è¨˜ã‚ˆã‚Š',
                    content: 'ä»Šæ—¥ã¯æ—©æœã‹ã‚‰å±±ã¸ã€‚æœéœ§ãŒå¹»æƒ³çš„ã§ã€å…‰ã¨å½±ã®ã‚³ãƒ³ãƒˆãƒ©ã‚¹ãƒˆãŒç¾ã—ã„ä¸€ç¬ã‚’æ‰ãˆã‚‹ã“ã¨ãŒã§ãã¾ã—ãŸ...',
                    date: this.formatDate(new Date(today.getTime() - 10 * 24 * 60 * 60 * 1000)),
                    type: 'diary',
                    tags: ['æ’®å½±', 'å±±']
                }
            ];
        }
    
        /**
         * Notionã®ãƒ†ã‚­ã‚¹ãƒˆãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’æŠ½å‡º
         */
        extractText(property) {
            if (!property) return '';
            
            if (property.title) {
                return property.title.map(text => text.plain_text).join('');
            }
            if (property.rich_text) {
                return property.rich_text.map(text => text.plain_text).join('');
            }
            return '';
        }
    
        /**
         * Notionã®æ—¥ä»˜ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’æŠ½å‡º
         */
        extractDate(property) {
            if (!property) return this.formatDate(new Date());
            
            if (property.date && property.date.start) {
                return this.formatDate(new Date(property.date.start));
            }
            if (property.created_time) {
                return this.formatDate(new Date(property.created_time));
            }
            return this.formatDate(new Date());
        }
    
        /**
         * Notionã®ã‚»ãƒ¬ã‚¯ãƒˆãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’æŠ½å‡º
         */
        extractSelect(property) {
            return property?.select?.name || '';
        }
    
        /**
         * Notionã®ãƒãƒ«ãƒã‚»ãƒ¬ã‚¯ãƒˆãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’æŠ½å‡º
         */
        extractMultiSelect(property) {
            return property?.multi_select?.map(item => item.name) || [];
        }
    
        /**
         * æ—¥ä»˜ã‚’ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
         */
        formatDate(date) {
            return date.toLocaleDateString('ja-JP', {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit'
            }).replace(/\//g, '.');
        }
    
        /**
         * æ—¥è¨˜ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’å³ã‚«ãƒ©ãƒ ã«è¡¨ç¤º
         */
        async renderDiary(containerId = 'diary-content') {
            const container = document.getElementById(containerId);
            if (!container) {
                console.log('æ—¥è¨˜ã‚³ãƒ³ãƒ†ãƒŠãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                return;
            }
    
            try {
                console.log('ğŸ“– æ—¥è¨˜ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’èª­ã¿è¾¼ã¿ä¸­...');
                const articles = await this.fetchArticles(8);
                
                // æ—¥è¨˜ãƒ»è¨˜äº‹ãƒ»çŸ­æ­Œã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’æŠ½å‡º
                const diaryContent = articles.filter(item => 
                    ['diary', 'article', 'tanka', 'event', 'news'].includes(item.type)
                ).slice(0, 6);
    
                let html = '';
                
                diaryContent.forEach(item => {
                    const formattedContent = this.formatDiaryContent(item.content, item.type);
                    const typeIcon = this.getTypeIcon(item.type);
                    
                    html += `
                        <div class="diary-entry">
                            <div class="diary-meta">
                                <span class="diary-type">${typeIcon}</span>
                                <span class="diary-date">${item.date}</span>
                            </div>
                            <div class="diary-content-text">
                                ${formattedContent}
                            </div>
                        </div>
                    `;
                });
    
                container.innerHTML = html;
                console.log('ğŸ“– æ—¥è¨˜ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®èª­ã¿è¾¼ã¿å®Œäº†');
    
            } catch (error) {
                console.error('æ—¥è¨˜èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', error);
                container.innerHTML = `
                    <div class="diary-entry">
                        <p>ä»Šæ—¥ã¯æ–°ã—ã„æ’®å½±ã‚¹ãƒãƒƒãƒˆã‚’æ¢ç´¢ã—ã¾ã—ãŸã€‚å…‰ã¨å½±ãŒç¹”ã‚Šãªã™ç¾ã—ã„ç¬é–“ã‚’æ‰ãˆã‚‹ã“ã¨ãŒã§ãã€å†™çœŸã®æŒã¤ç„¡é™ã®å¯èƒ½æ€§ã‚’æ„Ÿã˜ã¦ã„ã¾ã™ã€‚</p>
                    </div>
                    <div class="diary-entry">
                        <p>è‰²å½©è±Šã‹ãªå¤•ç„¼ã‘ãŒç©ºã‚’æŸ“ã‚ã‚‹æ™‚é–“å¸¯ã€‚è‡ªç„¶ãŒè¦‹ã›ã‚‹èŠ¸è¡“çš„ãªç¬é–“ã«å¿ƒã‚’å¥ªã‚ã‚Œã¾ã—ãŸã€‚ã‚«ãƒ¡ãƒ©ã‚’é€šã—ã¦ä¸–ç•Œã‚’è¦‹ã‚‹ã“ã¨ã®å–œã³ã‚’å†ç¢ºèªã—ã¦ã„ã¾ã™ã€‚</p>
                    </div>
                    <div class="diary-entry">
                        <p>è¡—ã®å°ã•ãªã‚«ãƒ•ã‚§ã§å‡ºä¼šã£ãŸå…‰æ™¯ã€‚æ—¥å¸¸ã«éš ã‚Œã¦ã„ã‚‹ç‰¹åˆ¥ãªç¬é–“ã‚’è¦‹ã¤ã‘ã€ãã‚Œã‚’å†™çœŸã«æ®‹ã™ã“ã¨ã®å¤§åˆ‡ã•ã‚’æ„Ÿã˜ã¾ã—ãŸã€‚</p>
                    </div>
                `;
            }
        }
    
        /**
         * æ—¥è¨˜ç”¨ã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
         */
        formatDiaryContent(content, type) {
            if (type === 'tanka') {
                // çŸ­æ­Œã®å ´åˆã¯æ”¹è¡Œã‚’ä¿æŒã—ã€ã‚¹ã‚¿ã‚¤ãƒ«ã‚’èª¿æ•´
                return `<div class="tanka-content">${content.replace(/\\n/g, '<br>')}</div>`;
            }
            
            // æ—¥è¨˜ã®å ´åˆã¯é©åº¦ãªé•·ã•ã§åˆ‡ã‚Šè©°ã‚
            const maxLength = 120;
            if (content.length > maxLength) {
                return content.substring(0, maxLength) + '...';
            }
            return content;
        }
    
        /**
         * ã‚¿ã‚¤ãƒ—ã«å¿œã˜ãŸã‚¢ã‚¤ã‚³ãƒ³ã‚’å–å¾—
         */
        getTypeIcon(type) {
            const icons = {
                diary: 'ğŸ“”',
                article: 'ğŸ“',
                tanka: 'ğŸŒ¸',
                event: 'ğŸ“…',
                news: 'ğŸ“°'
            };
            return icons[type] || 'ğŸ“–';
        }
    }
    
    // ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹
    window.notionAPI = new NotionAPI({
        useFallback: true // ç¾åœ¨ã¯ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ã‚’ä½¿ç”¨
    });
    </script>
    
    <script>
        // ğŸ”— Initialize systems on page load
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸš€ sogoods.net Dynamic Systems Loading...');
            
            // Photo system is auto-initialized in photo-manager.js
            // Notion integration will be initialized if available
            
            setTimeout(() => {
                console.log('ğŸ“Š System Status:');
                console.log('   ğŸ“· Photo Manager: Active');
                console.log('   ğŸ”¢ Real-time Stats: Active');
                console.log('   ğŸ”„ Auto-refresh: 30s photos, 5s stats');
                console.log('   ğŸ­ Interactive Features: Active');
                console.log('');
                console.log('ğŸ“ Add photos to:');
                console.log('   â€¢ /photos/miiko/ (main display)');
                console.log('   â€¢ /photos/gallery/ (mini images)');
            }, 1000);

            // ğŸ­ Interactive Features Initialization
            initializeInteractiveFeatures();
            
            // ğŸ“ TII Database System Initialization
            initializeTIISystem();
        });

        // ğŸ”µ Blue Circle Interaction System
        function initializeInteractiveFeatures() {
            console.log('ğŸ­ Initializing interactive features...');
            
            // Blue circle disappearing effect (ãƒ­ã‚´å††ã‚‚å«ã‚€)
            const blueCircles = document.querySelectorAll('.logo-circle-left, .blue-circle-news, .blue-circle-bottom');
            blueCircles.forEach(circle => {
                circle.addEventListener('click', function() {
                    console.log('ğŸ”µ Blue circle clicked - disappearing...');
                    this.classList.add('disappearing');
                    
                    // Remove element after animation
                    setTimeout(() => {
                        this.style.display = 'none';
                    }, 600);
                });
            });

            // ğŸ”¢ Number to Tanka transformation
            initializeTankaSystem();
            
            // ğŸ–¼ï¸ Mini Gallery popup functionality  
            initializeMiniGallery();
        }

        // ğŸ–¼ï¸ Mini Gallery Popup System
        function initializeMiniGallery() {
            console.log('ğŸ–¼ï¸ Initializing mini gallery popup...');
            
            const miniImages = document.querySelectorAll('.mini-image');
            miniImages.forEach(img => {
                img.addEventListener('click', function() {
                    const originalSrc = this.getAttribute('data-original');
                    const photoType = this.getAttribute('data-photo-type');
                    const fileName = this.getAttribute('data-file-name');
                    
                    console.log(`ğŸ–¼ï¸ Mini gallery clicked: ${photoType} - ${fileName}`);
                    showMiniGalleryPopup(this.src, this.alt, originalSrc);
                });
                
                // ãƒ›ãƒãƒ¼åŠ¹æœã‚’è¿½åŠ 
                img.style.cursor = 'pointer';
                img.style.transition = 'transform 0.2s ease';
                
                img.addEventListener('mouseenter', function() {
                    this.style.transform = 'scale(1.05)';
                });
                
                img.addEventListener('mouseleave', function() {
                    this.style.transform = 'scale(1)';
                });
            });
        }

        function showMiniGalleryPopup(thumbnailSrc, imageAlt, originalSrc = null) {
            console.log('ğŸ–¼ï¸ Opening mini gallery popup - Original:', originalSrc || thumbnailSrc);
            
            // æ—¢å­˜ã®ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã‚’å‰Šé™¤
            const existingPopup = document.querySelector('.mini-gallery-popup');
            if (existingPopup) {
                existingPopup.remove();
            }

            // ã‚ªãƒªã‚¸ãƒŠãƒ«ç”»åƒãŒã‚ã‚Œã°ãã‚Œã‚’ä½¿ç”¨ã€ãªã‘ã‚Œã°ã‚µãƒ ãƒã‚¤ãƒ«ã‚’é«˜è§£åƒåº¦åŒ–
            const displaySrc = originalSrc || thumbnailSrc.replace('w=100&h=75', 'w=1200&h=900');

            const popup = document.createElement('div');
            popup.className = 'mini-gallery-popup';
            popup.innerHTML = `
                <img src="${displaySrc}" alt="${imageAlt}">
            `;

            popup.addEventListener('click', function() {
                popup.classList.remove('show');
                setTimeout(() => popup.remove(), 300);
            });

            document.body.appendChild(popup);

            // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
            requestAnimationFrame(() => {
                popup.classList.add('show');
            });

            console.log(`ğŸ–¼ï¸ Showing gallery popup: ${imageAlt}`);
        }

        // ğŸ“ Short Poem (Tanka) Collection System
        const tankaCollection = [
            "å†¬ã®æœ\nçª“è¾ºã«åº§ã‚‹\nçŒ«ã®ç³\né™å¯‚ã‚’æ˜ ã—\næ™‚ãŒæ­¢ã¾ã‚‹",
            "æ¡œæ•£ã‚Š\né¢¨ã«èˆã„è¸Šã‚‹\nèŠ±ã³ã‚‰ã‚ˆ\nå¿ƒã«æ®‹ã‚‹\næ˜¥ã®è¨˜æ†¶",
            "å¤•æš®ã‚Œã«\nè¡—ç¯ãŒç‚¹ã\né“ã™ãŒã‚‰\nå½±ãŒé•·ãã¦\nå®¶è·¯æ€¥ã",
            "é›¨éŸ³ãŒ\nå±‹æ ¹ã‚’å©ã„ã¦\néŸ¿ãã¨ã\næœ¬ã‚’é–‹ã„ã¦\né™ã‹ã«èª­ã‚€",
            "æ˜Ÿç©ºã‚’\nè¦‹ä¸Šã’ã‚‹å¤œã«\næ€ã†ã“ã¨\nå°ã•ãªè‡ªåˆ†\nå¤§ããªå®‡å®™",
            "ã‚³ãƒ¼ãƒ’ãƒ¼ã®\næ¹¯æ°—ãŒç«‹ã¡ä¸Šã‚‹\næœã®ã²ã¨æ™‚\nã‚†ã£ãã‚Šã¨\nä»Šæ—¥ã‚’å§‹ã‚ã‚‹",
            "å†™çœŸã®ä¸­\nç¬‘é¡”ãŒèªã‚‹\nç‰©èª\næ™‚ã‚’è¶…ãˆã¦\nå¿ƒã«éŸ¿ã",
            "æµ·ã®æ³¢\nç ‚æµœã«å¯„ã›ã‚‹\nãƒªã‚ºãƒ ã«\nå¿ƒã‚‚è»½ã‚„ã‹\næ­©ã„ã¦ã‚†ã",
            "ç·‘é™°ã§\né¢¨ãŒé ¬ã‚’\næ’«ã§ã¦ã„ã\næœ¨æ¼ã‚Œæ—¥è¸Šã‚Š\nå¤ã‚’æ„Ÿã˜ã‚‹",
            "æœˆæ˜ã‹ã‚Š\nçª“ã‹ã‚‰å·®ã—ã¦\néƒ¨å±‹ã‚’ç…§ã‚‰ã™\né™ã‹ãªå¤œã«\næ€ã„ã‚’é¦³ã›ã‚‹",
            "æœéœ²ã«\nå…‰ãŒå®¿ã‚Š\nã‚­ãƒ©ã‚­ãƒ©ã¨\næ–°ã—ã„æ—¥ã®\nå§‹ã¾ã‚Šã‚’å‘Šã’ã‚‹",
            "å‹ã¨éã”ã™\nä½•æ°—ãªã„æ™‚é–“\nã‹ã‘ãŒãˆã®ãªã„\nç¬‘ã„å£°ãŒ\nè¨˜æ†¶ã«åˆ»ã¾ã‚Œã‚‹",
            "æœ¬ã®é \nã‚ãã‚‹ãŸã³ã«\næ–°ä¸–ç•Œ\næƒ³åƒã®ç¿¼\nåºƒãŒã£ã¦ã‚†ã",
            "å°é³¥ãŸã¡\nç©ºã‚’è‡ªç”±ã«\né£›ã³å›ã‚Š\nç¾¨ã¾ã—ãã¦\nè¦‹ä¸Šã’ã‚‹ç©º",
            "èŠ±å£‡ã«ã¯\nè‰²ã¨ã‚Šã©ã‚Šã®\nèŠ±ãŒå’²ã\nè¶ãŒèˆã„è¸Šã‚‹\nåˆå¾Œã®ã²ã¨ã¨ã",
            "å¤•é™½ãŒ\nç©ºã‚’æŸ“ã‚ã¦\nã‚ªãƒ¬ãƒ³ã‚¸è‰²\nä»Šæ—¥ã¨ã„ã†æ—¥ã‚’\nç¾ã—ãçµ‚ãˆã‚‹",
            "é›²ãŒæµã‚Œ\nå½¢ã‚’å¤‰ãˆã¦\nç©ºã®æ—…\næƒ³åƒè†¨ã‚‰ã‚€\né’ã„åˆå¾Œ",
            "ã‚­ãƒƒãƒãƒ³ã§\næ–™ç†ã™ã‚‹éŸ³\nå¿ƒåœ°ã‚ˆã\nå®¶æ—ã®ç¬‘é¡”\næ€ã„æµ®ã‹ã¹ã¦",
            "æ•£æ­©é“\nå­£ç¯€ã®ç§»ã‚ã„\næ„Ÿã˜ã¤ã¤\nä¸€æ­©ä¸€æ­©ãŒ\näººç”Ÿã®æ­©ã¿",
            "å¤œæ›´ã‘ã«\né™å¯‚åŒ…ã¾ã‚Œ\nè€ƒãˆã‚‹\næ˜æ—¥ã¸ã®å¸Œæœ›\nèƒ¸ã«ç§˜ã‚ã¦",
            "å¤ã„å†™çœŸ\næ€ã„å‡ºè˜‡ã‚Š\næ‡ã‹ã—ã\nã‚ã®æ—¥ã®è‡ªåˆ†ã«\nä¼šã„ã«è¡Œã‘ã‚‹",
            "é›ªæ™¯è‰²\nçœŸã£ç™½ãªä¸–ç•Œ\nåŒ…ã¾ã‚Œã¦\nå¿ƒã‚‚æ¸…ã‚‰ã‹\næ–°ã—ã„æ°—æŒã¡",
            "æ¸©ã‹ã„\nå®¶æ—ã®å›£ã‚‰ã‚“\nå›²ã‚“ã§\nå¹¸ã›ã ãªã¨\nå¿ƒã‹ã‚‰æ€ã†",
            "æ–°ç·‘ãŒ\né¢¨ã«æºã‚Œã¦\nè¼ã„ã¦\nå‘½ã‚ãµã‚Œã‚‹\nå­£ç¯€ã®å§‹ã¾ã‚Š"
        ];

        let tankaIndex = 0;
        const collectedTanka = [];

        function initializeTankaSystem() {
            console.log('ğŸ“ Initializing Tanka transformation system...');
            
            const numbers = document.querySelectorAll('.number');
            
            numbers.forEach((number, index) => {
                let isTransformed = false;
                let hoverTimeout;
                
                // Mouse enter - show tanka after delay
                number.addEventListener('mouseenter', function() {
                    if (isTransformed) return;
                    
                    hoverTimeout = setTimeout(() => {
                        showTanka(this, index);
                        isTransformed = true;
                    }, 800); // 0.8ç§’å¾Œã«çŸ­æ­Œè¡¨ç¤º
                });
                
                // Mouse leave - clear timeout if not transformed yet
                number.addEventListener('mouseleave', function() {
                    clearTimeout(hoverTimeout);
                    
                    if (isTransformed) {
                        // Reset to number after some time
                        setTimeout(() => {
                            resetToNumber(this, index);
                            isTransformed = false;
                        }, 2000);
                    }
                });
                
                // Click - grab the tanka
                number.addEventListener('click', function(e) {
                    e.preventDefault();
                    if (isTransformed) {
                        grabTanka(this, index);
                    } else {
                        // Quick transform on click
                        clearTimeout(hoverTimeout);
                        showTanka(this, index);
                        isTransformed = true;
                        
                        setTimeout(() => {
                            grabTanka(this, index);
                        }, 500);
                    }
                });
            });
        }

        function showTanka(element, index) {
            // Use CSV-based tanka system if available
            if (window.tankaSystem && window.tankaSystem.isInitialized) {
                const tanka = window.tankaSystem.getRandomTanka();
                if (tanka) {
                    element.classList.add('tanka-mode');
                    element.textContent = tanka.text;
                    element.setAttribute('data-tanka-id', tanka.id);
                    element.setAttribute('data-tanka', tanka.text);
                    
                    console.log(`ğŸ“ Showing CSV tanka ${tanka.id}: "${tanka.text.substring(0, 30)}..."`);
                    return;
                }
            }
            
            // Fallback to static collection
            const tanka = tankaCollection[tankaIndex % tankaCollection.length];
            tankaIndex++;
            
            element.classList.add('tanka-mode');
            element.textContent = tanka;
            element.setAttribute('data-tanka', tanka);
            
            console.log(`ğŸ“ Showing static tanka ${tankaIndex}: "${tanka.replace(/\n/g, ' / ')}"`);
        }

        function resetToNumber(element, index) {
            element.classList.remove('tanka-mode');
            element.textContent = element.getAttribute('data-original-number') || (index + 1);
        }

        function grabTanka(element, index) {
            const tankaId = element.getAttribute('data-tanka-id');
            const tanka = element.getAttribute('data-tanka');
            if (!tanka) return;
            
            element.classList.add('grabbed');
            
            // Use advanced tanka system for CSV-based tanka
            if (tankaId && window.tankaSystem && window.tankaSystem.isInitialized) {
                const tankaData = window.tankaSystem.tankaDatabase.find(t => t.id == tankaId);
                if (tankaData) {
                    window.tankaSystem.displayVerticalTanka(tankaData, element);
                    console.log(`ğŸ¤ Opening vertical tanka display for CSV tanka ${tankaId}`);
                    return;
                }
            }
            
            // Fallback for static tanka
            collectedTanka.push(tanka);
            
            console.log(`ğŸ¤ Grabbed static tanka: "${tanka.replace(/\n/g, ' / ')}"`);
            console.log(`ğŸ“š Collection now has ${collectedTanka.length} tanka(s)`);
            
            // Visual feedback for static tanka
            const grabMessage = document.createElement('div');
            grabMessage.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: rgba(33, 150, 243, 0.9);
                color: white;
                padding: 10px 20px;
                border-radius: 20px;
                font-size: 14px;
                z-index: 1000;
                animation: fadeInOut 2s ease-out forwards;
                pointer-events: none;
            `;
            
            grabMessage.textContent = `ğŸ“š çŸ­æ­Œã‚’ã¤ã‹ã¿ã¾ã—ãŸï¼ (${collectedTanka.length}é¦–ç›®)`;
            document.body.appendChild(grabMessage);
            
            // Add fadeInOut animation
            const style = document.createElement('style');
            style.textContent = `
                @keyframes fadeInOut {
                    0% { opacity: 0; transform: translate(-50%, -50%) scale(0.8); }
                    20% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
                    80% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
                    100% { opacity: 0; transform: translate(-50%, -50%) scale(0.8); }
                }
            `;
            document.head.appendChild(style);
            
            setTimeout(() => {
                grabMessage.remove();
                style.remove();
            }, 2000);
            
            // Reset element
            setTimeout(() => {
                resetToNumber(element, index);
                element.classList.remove('grabbed');
            }, 1000);
        }

        // ğŸ“ TII Database System
        function initializeTIISystem() {
            console.log('ğŸ“ Initializing TII database system...');
            
            const submitButton = document.getElementById('tii-submit');
            const inputTextarea = document.getElementById('tii-input');
            const authorInput = document.getElementById('tii-author');

            if (submitButton && inputTextarea) {
                submitButton.addEventListener('click', submitTIIEntry);
                
                // Enter key submit (Ctrl+Enter)
                inputTextarea.addEventListener('keydown', function(e) {
                    if (e.ctrlKey && e.key === 'Enter') {
                        submitTIIEntry();
                    }
                });
            }

            // Load existing entries
            loadTIIEntries();

            // Auto-refresh entries every 30 seconds
            setInterval(loadTIIEntries, 30000);
        }

        async function submitTIIEntry() {
            const input = document.getElementById('tii-input');
            const author = document.getElementById('tii-author');
            const submitBtn = document.getElementById('tii-submit');

            const content = input.value.trim();
            if (!content) {
                alert('å†…å®¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }

            // Disable button during submission
            submitBtn.disabled = true;
            submitBtn.textContent = 'æŠ•ç¨¿ä¸­...';

            try {
                // localStorageåŸºç›¤ã§ã®æŠ•ç¨¿å‡¦ç†
                const authorName = author.value.trim() || 'åŒ¿å';
                const timestamp = new Date().toISOString();
                
                // æ—¢å­˜ã®ã‚¨ãƒ³ãƒˆãƒªãƒ¼ã‚’å–å¾—
                const existingEntries = JSON.parse(localStorage.getItem('tii-entries') || '[]');
                
                // æ–°ã—ã„ã‚¨ãƒ³ãƒˆãƒªãƒ¼ã‚’ä½œæˆ
                const newEntry = {
                    id: Date.now() + '_' + Math.random().toString(36).substr(2, 9),
                    content: content,
                    author: authorName,
                    timestamp: timestamp
                };
                
                // æ–°ã—ã„ã‚¨ãƒ³ãƒˆãƒªãƒ¼ã‚’é…åˆ—ã®å…ˆé ­ã«è¿½åŠ ï¼ˆæœ€æ–°é †ï¼‰
                existingEntries.unshift(newEntry);
                
                // æœ€å¤§100ã‚¨ãƒ³ãƒˆãƒªãƒ¼ã«åˆ¶é™
                if (existingEntries.length > 100) {
                    existingEntries.splice(100);
                }
                
                // localStorageã«ä¿å­˜
                localStorage.setItem('tii-entries', JSON.stringify(existingEntries));
                
                console.log('âœ… TII entry submitted successfully to localStorage');
                
                // Clear form
                input.value = '';
                author.value = '';
                
                // Reload entries
                loadTIIEntries();
                
                // Visual feedback
                showTIIFeedback('æŠ•ç¨¿ãŒå®Œäº†ã—ã¾ã—ãŸï¼', 'success');

            } catch (error) {
                console.error('âŒ TII submission failed:', error);
                showTIIFeedback('æŠ•ç¨¿ã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
            } finally {
                // Re-enable button
                submitBtn.disabled = false;
                submitBtn.textContent = 'æŠ•ç¨¿';
            }
        }

        async function loadTIIEntries() {
            const entriesContainer = document.getElementById('tii-entries');
            if (!entriesContainer) return;

            try {
                // localStorageã‹ã‚‰ã‚¨ãƒ³ãƒˆãƒªãƒ¼ã‚’èª­ã¿è¾¼ã¿
                const entries = JSON.parse(localStorage.getItem('tii-entries') || '[]');
                
                // ã‚¨ãƒ³ãƒˆãƒªãƒ¼ã‚’æ–°ã—ã„é †ã«ã‚½ãƒ¼ãƒˆ
                entries.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
                
                displayTIIEntries(entries);
                console.log(`ğŸ“ Loaded ${entries.length} TII entries from localStorage`);

            } catch (error) {
                console.error('âŒ Failed to load TII entries:', error);
                entriesContainer.innerHTML = '<div class="tii-error">ã‚¨ãƒ³ãƒˆãƒªãƒ¼ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ</div>';
            }
        }

        function displayTIIEntries(entries) {
            const container = document.getElementById('tii-entries');
            if (!container) return;

            if (entries.length === 0) {
                container.innerHTML = '<div class="tii-loading">ã¾ã ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãŒã‚ã‚Šã¾ã›ã‚“</div>';
                return;
            }

            const entriesHTML = entries.map(entry => {
                const date = new Date(entry.timestamp);
                const timeString = date.toLocaleDateString('ja-JP', {
                    month: 'short',
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });

                return `
                    <div class="tii-entry">
                        <div class="tii-entry-content">${escapeHtml(entry.content)}</div>
                        <div class="tii-entry-meta">
                            <span class="tii-entry-author">${escapeHtml(entry.author)}</span>
                            <span class="tii-entry-time">${timeString}</span>
                        </div>
                    </div>
                `;
            }).join('');

            container.innerHTML = entriesHTML;
        }

        function showTIIFeedback(message, type) {
            const feedback = document.createElement('div');
            feedback.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${type === 'success' ? 'rgba(76, 175, 80, 0.9)' : 'rgba(244, 67, 54, 0.9)'};
                color: white;
                padding: 12px 20px;
                border-radius: 8px;
                font-size: 14px;
                z-index: 10000;
                animation: slideIn 0.3s ease-out;
            `;
            
            feedback.textContent = message;
            document.body.appendChild(feedback);

            setTimeout(() => {
                feedback.style.animation = 'slideOut 0.3s ease-out forwards';
                setTimeout(() => feedback.remove(), 300);
            }, 2000);
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Store original numbers for reset
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(() => {
                const numbers = document.querySelectorAll('.number');
                numbers.forEach((number, index) => {
                    number.setAttribute('data-original-number', number.textContent);
                });
            }, 100);
        });

        // ğŸ“¸ PhotoManager Integration - sogoods.net Photo Manager
        /**
         * sogoods.net Photo Manager
         * ãƒ©ãƒ³ãƒ€ãƒ å†™çœŸè¡¨ç¤ºã¨ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ‡ãƒ¼ã‚¿ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ 
         */

        class PhotoManager {
            constructor() {
                this.photosPath = '/photos';
                this.miikoPhotos = [];
                this.galleryPhotos = [];
                this.uploadedPhotos = []; // ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã•ã‚ŒãŸå†™çœŸã‚’ä¿å­˜
                this.currentPhoto = null;
                this.updateInterval = null;
                this.serverStorageEnabled = false; // ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ãƒ•ãƒ©ã‚°
                this.stats = {
                    totalPhotos: 0,
                    viewCount: 0,
                    lastUpdate: new Date(),
                    randomSeed: Math.floor(Math.random() * 1000)
                };
                
                this.init();
            }

            async init() {
                // ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸å¯ç”¨æ€§ãƒã‚§ãƒƒã‚¯
                await this.checkServerStorage();
                
                // ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å†™çœŸã‚’å¾©å…ƒ
                this.loadUploadedPhotos();
                
                await this.loadPhotoList();
                this.setupRandomDisplay();
                this.setupRealtimeStats();
                this.loadStats();
                
                // ãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰ã§Flickræ¥ç¶šãƒ†ã‚¹ãƒˆ
                if (window.location.hostname.includes('localhost') || window.location.hostname.includes('e2b.dev')) {
                    setTimeout(() => this.testFlickrConnection(), 3000);
                }
            }

            // ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã®å¯ç”¨æ€§ã‚’ãƒã‚§ãƒƒã‚¯
            async checkServerStorage() {
                try {
                    console.log('ğŸ” Checking server-side storage availability...');
                    
                    const response = await fetch('/api/photos/miiko', {
                        method: 'GET',
                        headers: {
                            'Accept': 'application/json'
                        }
                    });

                    if (response.ok) {
                        const result = await response.json();
                        if (result.success) {
                            this.serverStorageEnabled = true;
                            console.log(`âœ… Server storage available - ${result.totalCount} photos in /photos/miiko/`);
                            
                            // ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰æ—¢å­˜ã®å†™çœŸãƒªã‚¹ãƒˆã‚’å–å¾—ã—ã¦miikoPhotosã«çµ±åˆ
                            if (result.photos && result.photos.length > 0) {
                                const serverPhotos = result.photos.map(photo => photo.url);
                                console.log('ğŸ“ Server photos:', serverPhotos.length);
                            }
                        } else {
                            console.log('âš ï¸ Server storage API unavailable');
                        }
                    } else {
                        console.log('âš ï¸ Server storage not responding');
                    }
                } catch (error) {
                    console.log('âš ï¸ Server storage check failed:', error.message);
                }

                console.log(`ğŸ“¦ Storage mode: ${this.serverStorageEnabled ? 'Server-side (/photos/miiko/)' : 'Browser-only (localStorage)'}`);
            }

            // å†™çœŸãƒªã‚¹ãƒˆã‚’å‹•çš„ã«èª­ã¿è¾¼ã¿ï¼ˆé™çš„ãƒ•ã‚©ãƒ«ãƒ€ + APIï¼‰
            async loadPhotoList() {
                try {
                    console.log('ğŸ“¸ Loading photos from multiple sources...');
                    
                    // é™çš„å†™çœŸãƒ•ã‚©ãƒ«ãƒ€ã‹ã‚‰å†™çœŸã‚’å–å¾—
                    const staticPhotos = await this.loadStaticPhotos();
                    
                    // ã‚µãƒ¼ãƒãƒ¼ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‹ã‚‰å†™çœŸã‚’å–å¾—ï¼ˆãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼‰
                    const serverPhotos = await this.loadServerPhotos();
                    
                    // Flickrã‹ã‚‰å†™çœŸã‚’å–å¾—ï¼ˆãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼‰
                    const flickrPhotos = await this.fetchFlickrPhotos();
                    
                    // é™çš„ãƒ•ã‚©ãƒ«ãƒ€ã®å†™çœŸãŒæœ€å„ªå…ˆ
                    if (staticPhotos.mainPhotos.length > 0 || staticPhotos.galleryPhotos.length > 0) {
                        this.miikoPhotos = staticPhotos.mainPhotos;
                        this.galleryPhotos = staticPhotos.galleryPhotos;
                        
                        this.stats.totalPhotos = staticPhotos.mainPhotos.length + staticPhotos.galleryPhotos.length + this.uploadedPhotos.length;
                        console.log(`ğŸ“· Static photos loaded: ${staticPhotos.mainPhotos.length} main, ${staticPhotos.galleryPhotos.length} gallery, ${this.uploadedPhotos.length} uploaded`);
                        console.log(`ğŸ“¦ Storage mode: Static folders (/photos/main/, /photos/gallery/)`);
                        return;
                    }
                    
                    // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼šã‚µãƒ¼ãƒãƒ¼API + Flickr
                    let allPhotos = [...serverPhotos];
                    
                    if (flickrPhotos && flickrPhotos.length > 0) {
                        allPhotos = [...allPhotos, ...flickrPhotos];
                        console.log(`ğŸ“· Combined: ${serverPhotos.length} server + ${flickrPhotos.length} Flickr photos`);
                    } else if (serverPhotos.length === 0) {
                        console.log('âš ï¸ No server or Flickr photos, using sample photos');
                        allPhotos = this.getSamplePhotos();
                    }
                    
                    if (allPhotos.length > 0) {
                        // ãƒ¡ã‚¤ãƒ³ç”»åƒç”¨ã¨ã‚®ãƒ£ãƒ©ãƒªãƒ¼ç”¨ã«åˆ†å‰²
                        this.miikoPhotos = allPhotos.slice(0, Math.ceil(allPhotos.length * 0.7));
                        this.galleryPhotos = allPhotos.slice(Math.ceil(allPhotos.length * 0.7));
                        
                        this.stats.totalPhotos = allPhotos.length + this.uploadedPhotos.length;
                        console.log(`ğŸ“· Final: ${this.miikoPhotos.length} main photos, ${this.galleryPhotos.length} gallery photos, ${this.uploadedPhotos.length} uploaded photos`);
                        console.log(`ğŸ“¦ Storage: ${this.serverStorageEnabled ? 'Server + Browser' : 'Browser only'}`);
                    } else {
                        // å®Œå…¨ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
                        this.miikoPhotos = this.getSamplePhotos();
                        this.galleryPhotos = [];
                        this.stats.totalPhotos = this.miikoPhotos.length + this.uploadedPhotos.length;
                    }
                    
                } catch (error) {
                    console.warn('ğŸ“ Photo loading failed, using sample photos:', error.message);
                    this.miikoPhotos = this.getSamplePhotos();
                    this.galleryPhotos = [];
                    this.stats.totalPhotos = this.miikoPhotos.length + this.uploadedPhotos.length;
                }
            }

            // é™çš„å†™çœŸãƒ•ã‚©ãƒ«ãƒ€ã‹ã‚‰å†™çœŸã‚’å–å¾—
            async loadStaticPhotos() {
                try {
                    console.log('ğŸ“ Loading static photos from /photos/ folders...');
                    
                    // é™çš„å†™çœŸãƒªã‚¹ãƒˆã‚’èª­ã¿è¾¼ã¿
                    const response = await fetch('/photos/photo-list.js');
                    
                    if (response.ok) {
                        const scriptText = await response.text();
                        
                        // photo-list.jsã‚’evalã§å®Ÿè¡Œï¼ˆã‚»ã‚­ãƒ¥ã‚¢ç’°å¢ƒãªã®ã§OKï¼‰
                        eval(scriptText);
                        
                        if (window.sogoodsPhotoList) {
                            const mainPhotos = window.sogoodsPhotoList.main.map(filename => 
                                `/photos/main/${filename}`
                            );
                            const galleryPhotos = window.sogoodsPhotoList.gallery.map(filename => 
                                `/photos/gallery/${filename}`
                            );
                            
                            console.log(`âœ… Static photos loaded: ${mainPhotos.length} main, ${galleryPhotos.length} gallery`);
                            console.log(`ğŸ“… Last updated: ${window.sogoodsPhotoList.lastUpdated}`);
                            
                            return {
                                mainPhotos,
                                galleryPhotos
                            };
                        }
                    }
                    
                    throw new Error('Photo list not available');
                    
                } catch (error) {
                    console.warn('âš ï¸ Static photo loading failed:', error.message);
                    return {
                        mainPhotos: [],
                        galleryPhotos: []
                    };
                }
            }

            // ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰å†™çœŸãƒªã‚¹ãƒˆã‚’å–å¾—ï¼ˆãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ç”¨ï¼‰
            async loadServerPhotos() {
                if (!this.serverStorageEnabled) return [];

                try {
                    const response = await fetch('/api/photos/miiko');
                    if (response.ok) {
                        const result = await response.json();
                        if (result.success && result.photos) {
                            console.log(`ğŸ“ Loaded ${result.photos.length} photos from server storage`);
                            return result.photos.map(photo => photo.url);
                        }
                    }
                } catch (error) {
                    console.error('âŒ Failed to load server photos:', error);
                }
                
                return [];
            }

            // Flickr APIã‹ã‚‰å†™çœŸã‚’å–å¾—ï¼ˆCORSå¯¾å¿œç‰ˆï¼‰
            async fetchFlickrPhotos() {
                try {
                    console.log('ğŸ“¸ Attempting to fetch photos from Flickr...');
                    
                    // ä»£æ›¿æ‰‹æ®µ1: Flickrã®ç›´æ¥ç”»åƒURLã‚’ä½¿ç”¨ï¼ˆæ‰‹å‹•ã‚­ãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰
                    const curatedFlickrPhotos = await this.getCuratedFlickrPhotos();
                    if (curatedFlickrPhotos.length > 0) {
                        console.log(`âœ… Flickr: Using curated photos (${curatedFlickrPhotos.length} photos)`);
                        return curatedFlickrPhotos;
                    }
                    
                    throw new Error('All Flickr methods failed');
                    
                } catch (error) {
                    console.warn('âŒ Flickr API Error:', error.message);
                    return null;
                }
            }

            // sogoods Flickrã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‹ã‚‰ã®å³é¸å†™çœŸï¼ˆã‚µãƒ¼ãƒãƒ¼çµŒç”±ï¼‰
            async getCuratedFlickrPhotos() {
                try {
                    console.log('ğŸ“¸ Fetching sogoods Flickr photos via server API...');
                    
                    const response = await fetch('/api/flickr-photos');
                    
                    if (!response.ok) {
                        throw new Error(`Server error: ${response.status}`);
                    }
                    
                    const data = await response.json();
                    
                    if (data.success && data.photos && data.photos.length > 0) {
                        const photoUrls = data.photos.map(photo => photo.url);
                        console.log(`âœ… Server Flickr API: Retrieved ${photoUrls.length} photos from ${data.sourcePhotoIds} IDs`);
                        console.log('ğŸ“· Flickr photos:', photoUrls.slice(0, 3).map(url => url.split('/').pop()));
                        return photoUrls;
                    } else {
                        console.warn('âŒ No valid photos from server Flickr API');
                        return [];
                    }
                    
                } catch (error) {
                    console.warn('âŒ Server Flickr API failed:', error.message);
                    return [];
                }
            }

            // Flickrã®æ¥ç¶šãƒ†ã‚¹ãƒˆç”¨é–¢æ•°ï¼ˆãƒ‡ãƒãƒƒã‚°ç”¨ï¼‰
            async testFlickrConnection() {
                console.log('ğŸ” Testing Flickr API connection...');
                try {
                    const photos = await this.fetchFlickrPhotos();
                    if (photos && photos.length > 0) {
                        console.log(`âœ… Flickr Test: Successfully retrieved ${photos.length} photos`);
                        console.log('ğŸ“· First photo URL:', photos[0]);
                        return true;
                    } else {
                        console.log('âŒ Flickr Test: No photos retrieved');
                        return false;
                    }
                } catch (error) {
                    console.log('âŒ Flickr Test Error:', error);
                    return false;
                }
            }

            // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ç”¨ç©ºé…åˆ—ï¼ˆFlickrå†™çœŸã®ã¿ã‚’ä½¿ç”¨ï¼‰
            getSamplePhotos() {
                console.log('âš ï¸ No Flickr photos available - returning empty array');
                return [];
            }

            // ãƒ©ãƒ³ãƒ€ãƒ å†™çœŸè¡¨ç¤ºã®è¨­å®š
            setupRandomDisplay() {
                // åˆæœŸè¡¨ç¤º
                this.displayRandomPhoto();
                
                // 30ç§’ã”ã¨ã«å†™çœŸã‚’å¤‰æ›´
                setInterval(() => {
                    this.displayRandomPhoto();
                }, 30000);

                // å°ã•ã„ã‚®ãƒ£ãƒ©ãƒªãƒ¼ã‚‚æ›´æ–°
                this.updateMiniGallery();
                
                // 5åˆ†ã”ã¨ã«ã‚®ãƒ£ãƒ©ãƒªãƒ¼æ›´æ–°
                setInterval(() => {
                    this.updateMiniGallery();
                }, 300000);
            }

            // ãƒ©ãƒ³ãƒ€ãƒ ã«å†™çœŸã‚’è¡¨ç¤ºï¼ˆè‡ªå‹•ãƒªã‚µã‚¤ã‚ºä»˜ãï¼‰
            displayRandomPhoto() {
                // ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å†™çœŸã®ã‚ªãƒªã‚¸ãƒŠãƒ« + Flickrå†™çœŸã‚’çµ„ã¿åˆã‚ã›
                const uploadedOriginals = this.uploadedPhotos.map(photo => 
                    typeof photo === 'object' ? photo.original : photo
                );
                const allMainPhotos = [...uploadedOriginals, ...this.miikoPhotos];
                
                if (allMainPhotos.length === 0) return;
                
                const randomIndex = Math.floor(Math.random() * allMainPhotos.length);
                const selectedPhoto = allMainPhotos[randomIndex];
                
                const mainImage = document.querySelector('.main-image');
                if (mainImage) {
                    this.loadImageWithAutoResize(selectedPhoto, mainImage, {
                        targetWidth: 800,
                        targetHeight: 1200,
                        quality: 0.8
                    });
                    this.currentPhoto = selectedPhoto;
                    this.stats.viewCount++;
                }
                
                const photoType = randomIndex < uploadedOriginals.length ? 'uploaded' : 'flickr';
                console.log(`ğŸ² Random photo: ${randomIndex + 1}/${allMainPhotos.length} (${photoType})`);
            }

            // å°ã•ãªã‚®ãƒ£ãƒ©ãƒªãƒ¼ã‚’æ›´æ–°ï¼ˆã‚µãƒ ãƒã‚¤ãƒ«ä½¿ç”¨ã€ã‚ªãƒªã‚¸ãƒŠãƒ«ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—å¯¾å¿œï¼‰
            updateMiniGallery() {
                const miniImages = document.querySelectorAll('.mini-image');
                
                // ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å†™çœŸï¼ˆã‚µãƒ ãƒã‚¤ãƒ«/ã‚ªãƒªã‚¸ãƒŠãƒ«ï¼‰ + Flickrå†™çœŸã‚’çµ„ã¿åˆã‚ã›
                const allPhotos = [];
                
                // ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å†™çœŸã®å‡¦ç†ï¼ˆã‚µãƒ ãƒã‚¤ãƒ«è¡¨ç¤ºã€ã‚ªãƒªã‚¸ãƒŠãƒ«ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ï¼‰
                this.uploadedPhotos.forEach(photo => {
                    if (typeof photo === 'object') {
                        allPhotos.push({
                            thumbnail: photo.thumbnail || photo.original,
                            original: photo.original,
                            type: 'uploaded',
                            fileName: photo.fileName
                        });
                    } else {
                        // å¤ã„å½¢å¼ã®ã‚µãƒãƒ¼ãƒˆ
                        allPhotos.push({
                            thumbnail: photo,
                            original: photo,
                            type: 'uploaded',
                            fileName: 'legacy'
                        });
                    }
                });
                
                // Flickrå†™çœŸã®å‡¦ç†
                [...this.miikoPhotos, ...this.galleryPhotos].forEach(photo => {
                    allPhotos.push({
                        thumbnail: photo,
                        original: photo,
                        type: 'flickr',
                        fileName: 'flickr'
                    });
                });
                
                if (allPhotos.length === 0) return;
                
                miniImages.forEach((img, index) => {
                    const randomIndex = Math.floor(Math.random() * allPhotos.length);
                    const photoData = allPhotos[randomIndex];
                    
                    // ã‚µãƒ ãƒã‚¤ãƒ«ç”»åƒã‚’ãƒŸãƒ‹ã‚®ãƒ£ãƒ©ãƒªãƒ¼ã«è¡¨ç¤ºï¼ˆã‚°ãƒ¬ãƒ¼ã‚¹ã‚±ãƒ¼ãƒ«ï¼‰
                    this.loadImageWithAutoResize(photoData.thumbnail, img, {
                        targetWidth: 120,
                        targetHeight: 90,
                        quality: 0.7,
                        applyColorProcessing: 'grayscale'  // ã»ã¼ã‚°ãƒ¬ãƒ¼ã‚¹ã‚±ãƒ¼ãƒ«
                    });
                    
                    // ã‚ªãƒªã‚¸ãƒŠãƒ«ç”»åƒã‚’dataå±æ€§ã¨ã—ã¦ä¿å­˜
                    img.setAttribute('data-original', photoData.original);
                    img.setAttribute('data-photo-type', photoData.type);
                    img.setAttribute('data-file-name', photoData.fileName);
                    
                    // ãƒ›ãƒãƒ¼ã‚¨ãƒ•ã‚§ã‚¯ãƒˆç”¨ã®ã‚ªãƒªã‚¸ãƒŠãƒ«è‰²ç”»åƒã‚’æº–å‚™
                    this.setupMiniGalleryHoverEffect(img, photoData.thumbnail);
                });
                
                console.log(`ğŸ–¼ï¸ Mini gallery updated: ${allPhotos.length} photos available (${this.uploadedPhotos.length} uploaded)`);
            }

            // ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã•ã‚ŒãŸå†™çœŸã‚’ãƒ©ãƒ³ãƒ€ãƒ è¡¨ç¤ºã«è¿½åŠ ï¼ˆã‚µãƒ ãƒã‚¤ãƒ«ã¨ã‚ªãƒªã‚¸ãƒŠãƒ«ä¸¡æ–¹ä¿å­˜ï¼‰
            addUploadedPhoto(dataUrl, fileName) {
                // å†™çœŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆï¼ˆã‚ªãƒªã‚¸ãƒŠãƒ«ã¨ã‚µãƒ ãƒã‚¤ãƒ«ã®ä¸¡æ–¹ã‚’ä¿å­˜ï¼‰
                const photoObject = {
                    id: Date.now() + '_' + Math.random().toString(36).substr(2, 9),
                    fileName: fileName,
                    original: dataUrl,  // ã‚ªãƒªã‚¸ãƒŠãƒ«ç”»åƒ
                    thumbnail: null,    // ã‚µãƒ ãƒã‚¤ãƒ«ã¯å¾Œã§ç”Ÿæˆ
                    uploadDate: new Date().toISOString()
                };
                
                // ã‚µãƒ ãƒã‚¤ãƒ«ç”Ÿæˆ
                this.generateThumbnail(dataUrl, 120, 90, 0.7).then(thumbnailDataUrl => {
                    photoObject.thumbnail = thumbnailDataUrl;
                });
                
                // ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å†™çœŸé…åˆ—ã«è¿½åŠ 
                this.uploadedPhotos.push(photoObject);
                
                // çµ±è¨ˆæ›´æ–°
                this.stats.totalPhotos = this.uploadedPhotos.length + this.miikoPhotos.length + this.galleryPhotos.length;
                this.stats.lastUpdate = new Date();
                
                // ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ä¿å­˜ï¼ˆã‚»ãƒƒã‚·ãƒ§ãƒ³ç¶­æŒï¼‰
                this.saveUploadedPhotos();
                
                console.log(`ğŸ“¤ Photo added to rotation: ${fileName}`);
                console.log(`ğŸ“Š Total photos in rotation: ${this.stats.totalPhotos} (${this.uploadedPhotos.length} uploaded)`);
                
                // ãƒŸãƒ‹ã‚®ãƒ£ãƒ©ãƒªãƒ¼ã¨ãƒ¡ã‚¤ãƒ³ç”»åƒã‚’æ›´æ–°
                this.updateMiniGallery();
                this.displayRandomPhoto(); // ãƒ¡ã‚¤ãƒ³ç”»åƒã‚‚ã™ãã«æ–°ã—ã„å†™çœŸã‚’è¡¨ç¤ºå¯èƒ½ã«
            }

            // ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å†™çœŸã‚’ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ä¿å­˜
            saveUploadedPhotos() {
                try {
                    // ãƒ‡ãƒ¼ã‚¿URL ã¯å¤§ãã„ã®ã§ã€æœ€æ–°ã®10æšã®ã¿ä¿å­˜
                    const recentPhotos = this.uploadedPhotos.slice(-10);
                    localStorage.setItem('sogoods_uploaded_photos', JSON.stringify(recentPhotos));
                } catch (error) {
                    console.warn('âš ï¸ Failed to save uploaded photos to localStorage:', error);
                }
            }

            // ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‹ã‚‰ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å†™çœŸã‚’å¾©å…ƒ
            loadUploadedPhotos() {
                try {
                    const savedPhotos = localStorage.getItem('sogoods_uploaded_photos');
                    if (savedPhotos) {
                        this.uploadedPhotos = JSON.parse(savedPhotos);
                        console.log(`ğŸ“ Restored ${this.uploadedPhotos.length} uploaded photos from storage`);
                    }
                } catch (error) {
                    console.warn('âš ï¸ Failed to load uploaded photos from localStorage:', error);
                    this.uploadedPhotos = [];
                }
            }

            // ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ çµ±è¨ˆã®è¨­å®š
            setupRealtimeStats() {
                this.updateStats();
                
                // 5ç§’ã”ã¨ã«çµ±è¨ˆã‚’æ›´æ–°
                this.updateInterval = setInterval(() => {
                    this.updateStats();
                }, 5000);
            }

            // æ„å‘³ã®ã‚ã‚‹æ•°å­—ã‚’ç”Ÿæˆãƒ»æ›´æ–°
            updateStats() {
                const now = new Date();
                this.stats.lastUpdate = now;
                
                // ç¾åœ¨æ™‚åˆ»ãƒ™ãƒ¼ã‚¹ã®å‹•çš„æ•°å­—
                const currentStats = {
                    hour: now.getHours(),
                    minute: now.getMinutes(),
                    day: now.getDate(),
                    month: now.getMonth() + 1,
                    totalPhotos: this.stats.totalPhotos,
                    viewCount: this.stats.viewCount,
                    uptime: Math.floor((now - this.stats.startTime) / 1000 / 60), // åˆ†å˜ä½
                    randomValue: Math.floor(Math.random() * 100) + 1,
                    heartbeat: Math.floor(Math.random() * 40) + 60, // 60-100 BPM
                    temperature: Math.floor(Math.random() * 10) + 18, // 18-28Â°C
                    humidity: Math.floor(Math.random() * 30) + 40, // 40-70%
                    visitors: Math.floor(Math.random() * 50) + this.stats.viewCount
                };
                
                this.updateNumberOverlays(currentStats);
                
                // localStorage ã«ä¿å­˜
                this.saveStats();
            }

            // æ•°å­—ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ã‚’æ›´æ–°
            updateNumberOverlays(stats) {
                const numbers = document.querySelectorAll('.number');
                if (numbers.length === 0) return;
                
                // æ„å‘³ã®ã‚ã‚‹æ•°å­—ã®ãƒãƒƒãƒ”ãƒ³ã‚°
                const meaningfulNumbers = [
                    stats.hour,                    // ç¾åœ¨æ™‚åˆ»
                    stats.minute,                  // ç¾åœ¨åˆ†
                    stats.day,                     // ä»Šæ—¥ã®æ—¥ä»˜
                    stats.month,                   // ç¾åœ¨æœˆ
                    stats.totalPhotos,             // ç·å†™çœŸæ•°
                    stats.viewCount,               // é–²è¦§æ•°
                    stats.uptime,                  // ç¨¼åƒæ™‚é–“ï¼ˆåˆ†ï¼‰
                    stats.randomValue,             // ãƒ©ãƒ³ãƒ€ãƒ å€¤
                    stats.heartbeat,               // å¿ƒæ‹æ•°é¢¨
                    stats.temperature,             // æ¸©åº¦é¢¨
                    stats.humidity,                // æ¹¿åº¦é¢¨
                    stats.visitors,                // è¨ªå•è€…æ•°é¢¨
                    Math.floor(Math.random() * 365) + 1,  // å¹´å†…æ—¥æ•°
                    Math.floor(Math.random() * 24) + 1,   // æ™‚é–“
                    Math.floor(Math.random() * 60) + 1,   // åˆ†ãƒ»ç§’
                    Math.floor(Math.random() * 12) + 1,   // æœˆ
                    Math.floor(Math.random() * 999) + 1,  // ãƒ©ãƒ³ãƒ€ãƒ 3æ¡
                    Math.floor(Math.random() * 99) + 1,   // ãƒ©ãƒ³ãƒ€ãƒ 2æ¡
                    Math.floor(Math.random() * 9) + 1,    // ãƒ©ãƒ³ãƒ€ãƒ 1æ¡
                    Math.floor(Math.random() * 50) + 1,   // å°ã•ãªãƒ©ãƒ³ãƒ€ãƒ å€¤
                    Math.floor(Math.random() * 200) + 100, // å¤§ãã‚ã®ãƒ©ãƒ³ãƒ€ãƒ å€¤
                    Math.floor(Math.random() * 10) + 1,   // ã‚·ãƒ³ãƒ—ãƒ«ãªæ•°å­—
                    Math.floor(Math.random() * 77) + 1,   // ç‰¹åˆ¥ãªç¯„å›²
                    stats.viewCount % 100              // é–²è¦§æ•°ã®ä¸‹2æ¡
                ];
                
                numbers.forEach((numberEl, index) => {
                    if (index < meaningfulNumbers.length) {
                        numberEl.textContent = meaningfulNumbers[index];
                    }
                });
                
                console.log(`ğŸ”¢ Stats updated: ${stats.hour}:${stats.minute}, Photos: ${stats.totalPhotos}, Views: ${stats.viewCount}`);
            }

            // çµ±è¨ˆã‚’localStorageã‹ã‚‰èª­ã¿è¾¼ã¿
            loadStats() {
                const saved = localStorage.getItem('sogoods_stats');
                if (saved) {
                    const savedStats = JSON.parse(saved);
                    this.stats = { ...this.stats, ...savedStats };
                }
                
                // é–‹å§‹æ™‚åˆ»ã‚’è¨­å®šï¼ˆåˆå›ã®ã¿ï¼‰
                if (!this.stats.startTime) {
                    this.stats.startTime = new Date();
                } else {
                    this.stats.startTime = new Date(this.stats.startTime);
                }
            }

            // çµ±è¨ˆã‚’localStorageã«ä¿å­˜
            saveStats() {
                localStorage.setItem('sogoods_stats', JSON.stringify(this.stats));
            }

            // è‡ªå‹•ãƒªã‚µã‚¤ã‚ºä»˜ãç”»åƒèª­ã¿è¾¼ã¿
            loadImageWithAutoResize(src, imgElement, options = {}) {
                const {
                    targetWidth = 800,
                    targetHeight = 600,
                    quality = 0.8,
                    fitMode = 'cover', // cover, contain, fill
                    applyColorProcessing = false // è‰²å‡¦ç†ã‚ªãƒ—ã‚·ãƒ§ãƒ³ ('grayscale', true, false)
                } = options;

                // ä¸€æ™‚çš„ã«ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤º
                imgElement.style.opacity = '0.5';
                
                const img = new Image();
                img.crossOrigin = 'anonymous'; // CORSå¯¾å¿œ
                
                img.onload = () => {
                    try {
                        // Canvas ã§è‡ªå‹•ãƒªã‚µã‚¤ã‚ºãƒ»ã‚¯ãƒ­ãƒƒãƒ—
                        const canvas = document.createElement('canvas');
                        const ctx = canvas.getContext('2d');
                        
                        // ã‚¢ã‚¹ãƒšã‚¯ãƒˆæ¯”è¨ˆç®—
                        const sourceRatio = img.width / img.height;
                        const targetRatio = targetWidth / targetHeight;
                        
                        let drawWidth, drawHeight, offsetX = 0, offsetY = 0;
                        
                        if (fitMode === 'cover') {
                            // cover: ã¯ã¿å‡ºã—ãŸéƒ¨åˆ†ã‚’ã‚¯ãƒ­ãƒƒãƒ—
                            if (sourceRatio > targetRatio) {
                                drawHeight = targetHeight;
                                drawWidth = drawHeight * sourceRatio;
                                offsetX = (targetWidth - drawWidth) / 2;
                            } else {
                                drawWidth = targetWidth;
                                drawHeight = drawWidth / sourceRatio;
                                offsetY = (targetHeight - drawHeight) / 2;
                            }
                            canvas.width = targetWidth;
                            canvas.height = targetHeight;
                        } else if (fitMode === 'contain') {
                            // contain: å…¨ä½“ã‚’è¡¨ç¤ºã€ä½™ç™½ã‚ã‚Š
                            if (sourceRatio > targetRatio) {
                                drawWidth = targetWidth;
                                drawHeight = drawWidth / sourceRatio;
                                offsetY = (targetHeight - drawHeight) / 2;
                            } else {
                                drawHeight = targetHeight;
                                drawWidth = drawHeight * sourceRatio;
                                offsetX = (targetWidth - drawWidth) / 2;
                            }
                            canvas.width = targetWidth;
                            canvas.height = targetHeight;
                            ctx.fillStyle = '#f0f0f0';
                            ctx.fillRect(0, 0, targetWidth, targetHeight);
                        }
                        
                        // é«˜å“è³ªãƒªã‚µã‚¤ã‚ºè¨­å®š
                        ctx.imageSmoothingEnabled = true;
                        ctx.imageSmoothingQuality = 'high';
                        
                        // ç”»åƒæç”»
                        ctx.drawImage(img, offsetX, offsetY, drawWidth, drawHeight);
                        
                        // è‰²å‡¦ç†ã‚’æ¡ä»¶ä»˜ãã§é©ç”¨
                        if (applyColorProcessing === 'grayscale') {
                            this.applyGrayscaleProcessing(ctx, targetWidth, targetHeight);
                        } else if (applyColorProcessing === true) {
                            this.applyColorProcessing(ctx, targetWidth, targetHeight);
                        }
                        
                        // æœ€é©åŒ–ã•ã‚ŒãŸDataURLã‚’ç”Ÿæˆ
                        const optimizedDataUrl = canvas.toDataURL('image/jpeg', quality);
                        
                        // å…ƒã®ç”»åƒè¦ç´ ã«é©ç”¨
                        imgElement.src = optimizedDataUrl;
                        imgElement.style.opacity = '1';
                        
                        console.log(`ğŸ–¼ï¸ Auto-resized: ${img.width}x${img.height} â†’ ${targetWidth}x${targetHeight}`);
                        
                    } catch (error) {
                        // Canvaså‡¦ç†ã«å¤±æ•—ã—ãŸå ´åˆã¯å…ƒç”»åƒã‚’ç›´æ¥è¡¨ç¤º
                        console.log('âš ï¸ Auto-resize failed, using original image:', error);
                        imgElement.src = src;
                        imgElement.style.opacity = '1';
                    }
                };
                
                img.onerror = () => {
                    // ç”»åƒèª­ã¿è¾¼ã¿å¤±æ•—æ™‚
                    console.log('âŒ Image load failed:', src);
                    imgElement.style.opacity = '1';
                };
                
                img.src = src;
            }

            // ã»ã¼ã‚°ãƒ¬ãƒ¼ã‚¹ã‚±ãƒ¼ãƒ«å‡¦ç†ã‚’é©ç”¨ï¼ˆãƒŸãƒ‹ã‚®ãƒ£ãƒ©ãƒªãƒ¼ç”¨ï¼‰
            applyGrayscaleProcessing(ctx, width, height) {
                try {
                    // ç”»åƒãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
                    const imageData = ctx.getImageData(0, 0, width, height);
                    const data = imageData.data;
                    
                    // ãƒ”ã‚¯ã‚»ãƒ«ã”ã¨ã«å‡¦ç†
                    for (let i = 0; i < data.length; i += 4) {
                        const r = data[i];
                        const g = data[i + 1];
                        const b = data[i + 2];
                        
                        // è¼åº¦ãƒ™ãƒ¼ã‚¹ã®ã‚°ãƒ¬ãƒ¼ã‚¹ã‚±ãƒ¼ãƒ«è¨ˆç®—
                        const luminance = 0.299 * r + 0.587 * g + 0.114 * b;
                        
                        // ã»ã¼ã‚°ãƒ¬ãƒ¼ã‚¹ã‚±ãƒ¼ãƒ«ï¼ˆã‚ãšã‹ã«å…ƒã®è‰²ã‚’æ®‹ã™ï¼‰
                        const colorRetention = 0.15; // 15%ã®è‰²ã‚’æ®‹ã™
                        const grayRetention = 0.85;   // 85%ã‚’ã‚°ãƒ¬ãƒ¼ã‚¹ã‚±ãƒ¼ãƒ«
                        
                        data[i]     = Math.round(luminance * grayRetention + r * colorRetention);
                        data[i + 1] = Math.round(luminance * grayRetention + g * colorRetention);
                        data[i + 2] = Math.round(luminance * grayRetention + b * colorRetention);
                        
                        // ã‚¢ãƒ«ãƒ•ã‚¡å€¤ã¯ãã®ã¾ã¾
                        // data[i + 3] ã¯ãã®ã¾ã¾
                    }
                    
                    // å‡¦ç†æ¸ˆã¿ç”»åƒãƒ‡ãƒ¼ã‚¿ã‚’é©ç”¨
                    ctx.putImageData(imageData, 0, 0);
                    
                } catch (error) {
                    console.log('âš ï¸ Grayscale processing skipped:', error.message);
                }
            }

            // ãƒŸãƒ‹ã‚®ãƒ£ãƒ©ãƒªãƒ¼ã®ãƒ›ãƒãƒ¼ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã‚’è¨­å®šï¼ˆã‚°ãƒ¬ãƒ¼ã‚¹ã‚±ãƒ¼ãƒ«â‡„ã‚ªãƒªã‚¸ãƒŠãƒ«è‰²ï¼‰
            setupMiniGalleryHoverEffect(imgElement, photoSrc) {
                let grayscaleImageSrc = null;
                let originalColorSrc = null;
                let isHovering = false;

                // ãƒ›ãƒãƒ¼é–‹å§‹æ™‚ï¼ˆã‚°ãƒ¬ãƒ¼ã‚¹ã‚±ãƒ¼ãƒ« â†’ ã‚ªãƒªã‚¸ãƒŠãƒ«è‰²ï¼‰
                imgElement.addEventListener('mouseenter', async () => {
                    if (isHovering) return;
                    isHovering = true;

                    // ã‚°ãƒ¬ãƒ¼ã‚¹ã‚±ãƒ¼ãƒ«ç”»åƒã‚’ä¿å­˜ï¼ˆç¾åœ¨è¡¨ç¤ºä¸­ï¼‰
                    if (!grayscaleImageSrc) {
                        grayscaleImageSrc = imgElement.src;
                    }

                    // ã‚ªãƒªã‚¸ãƒŠãƒ«è‰²ç”»åƒã‚’ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§ç”Ÿæˆ
                    if (!originalColorSrc) {
                        try {
                            originalColorSrc = await this.generateProcessedImage(photoSrc, {
                                targetWidth: 120,
                                targetHeight: 90,
                                quality: 0.7,
                                applyColorProcessing: false  // ãƒ›ãƒãƒ¼æ™‚ã¯ã‚ªãƒªã‚¸ãƒŠãƒ«è‰²
                            });
                        } catch (error) {
                            console.log('ãƒ›ãƒãƒ¼ç”¨ã‚ªãƒªã‚¸ãƒŠãƒ«è‰²ç”»åƒã®ç”Ÿæˆã«å¤±æ•—:', error);
                            return;
                        }
                    }

                    // ãƒ›ãƒãƒ¼ä¸­ã§ã‚ã‚Œã°ã‚ªãƒªã‚¸ãƒŠãƒ«è‰²ç”»åƒã«åˆ‡ã‚Šæ›¿ãˆ
                    if (isHovering && originalColorSrc) {
                        imgElement.src = originalColorSrc;
                    }
                });

                // ãƒ›ãƒãƒ¼çµ‚äº†æ™‚ï¼ˆã‚ªãƒªã‚¸ãƒŠãƒ«è‰² â†’ ã‚°ãƒ¬ãƒ¼ã‚¹ã‚±ãƒ¼ãƒ«ï¼‰
                imgElement.addEventListener('mouseleave', () => {
                    isHovering = false;
                    if (grayscaleImageSrc) {
                        imgElement.src = grayscaleImageSrc;
                    }
                });
            }

            // ãƒ—ãƒ­ã‚»ã‚¹æ¸ˆã¿ç”»åƒã‚’ç”Ÿæˆï¼ˆãƒ›ãƒãƒ¼ã‚¨ãƒ•ã‚§ã‚¯ãƒˆç”¨ï¼‰
            generateProcessedImage(src, options) {
                return new Promise((resolve, reject) => {
                    const {
                        targetWidth = 120,
                        targetHeight = 90,
                        quality = 0.7,
                        applyColorProcessing = true
                    } = options;

                    const img = new Image();
                    img.crossOrigin = 'anonymous';
                    
                    img.onload = () => {
                        try {
                            const canvas = document.createElement('canvas');
                            const ctx = canvas.getContext('2d');
                            
                            canvas.width = targetWidth;
                            canvas.height = targetHeight;
                            
                            // ã‚¢ã‚¹ãƒšã‚¯ãƒˆæ¯”è¨ˆç®—ã¨coverå‡¦ç†
                            const sourceRatio = img.width / img.height;
                            const targetRatio = targetWidth / targetHeight;
                            
                            let drawWidth, drawHeight, offsetX = 0, offsetY = 0;
                            
                            if (sourceRatio > targetRatio) {
                                drawHeight = targetHeight;
                                drawWidth = drawHeight * sourceRatio;
                                offsetX = (targetWidth - drawWidth) / 2;
                            } else {
                                drawWidth = targetWidth;
                                drawHeight = drawWidth / sourceRatio;
                                offsetY = (targetHeight - drawHeight) / 2;
                            }
                            
                            ctx.drawImage(img, offsetX, offsetY, drawWidth, drawHeight);
                            
                            // è‰²å‡¦ç†ã‚’é©ç”¨
                            if (applyColorProcessing === 'grayscale') {
                                this.applyGrayscaleProcessing(ctx, targetWidth, targetHeight);
                            } else if (applyColorProcessing === true) {
                                this.applyColorProcessing(ctx, targetWidth, targetHeight);
                            }
                            
                            // DataURLã‚’ç”Ÿæˆ
                            const processedDataUrl = canvas.toDataURL('image/jpeg', quality);
                            resolve(processedDataUrl);
                            
                        } catch (error) {
                            reject(error);
                        }
                    };
                    
                    img.onerror = () => reject(new Error('Image load failed'));
                    img.src = src;
                });
            }

            // åŸºæœ¬çš„ãªè‰²å‡¦ç†ã‚’é©ç”¨ï¼ˆãƒ¡ã‚¤ãƒ³ç”»åƒç”¨ï¼‰
            applyColorProcessing(ctx, width, height) {
                try {
                    // ã“ã®é–¢æ•°ã¯ä¸»ã«ãƒ¡ã‚¤ãƒ³ç”»åƒç”¨ã€‚ãƒŸãƒ‹ã‚®ãƒ£ãƒ©ãƒªãƒ¼ã«ã¯applyGrayscaleProcessingã‚’ä½¿ç”¨
                    console.log('ğŸ¨ Color processing applied (basic implementation)');
                } catch (error) {
                    console.log('âš ï¸ Color processing skipped:', error.message);
                }
            }

            // ã‚µãƒ ãƒã‚¤ãƒ«ç”Ÿæˆé–¢æ•°
            generateThumbnail(src, width = 120, height = 90, quality = 0.7) {
                return new Promise((resolve) => {
                    const img = new Image();
                    img.crossOrigin = 'anonymous';
                    
                    img.onload = () => {
                        try {
                            const canvas = document.createElement('canvas');
                            const ctx = canvas.getContext('2d');
                            
                            canvas.width = width;
                            canvas.height = height;
                            
                            // ã‚¢ã‚¹ãƒšã‚¯ãƒˆæ¯”è¨ˆç®—ã¨coverå‡¦ç†
                            const sourceRatio = img.width / img.height;
                            const targetRatio = width / height;
                            
                            let drawWidth, drawHeight, offsetX = 0, offsetY = 0;
                            
                            if (sourceRatio > targetRatio) {
                                drawHeight = height;
                                drawWidth = drawHeight * sourceRatio;
                                offsetX = (width - drawWidth) / 2;
                            } else {
                                drawWidth = width;
                                drawHeight = drawWidth / sourceRatio;
                                offsetY = (height - drawHeight) / 2;
                            }
                            
                            ctx.drawImage(img, offsetX, offsetY, drawWidth, drawHeight);
                            
                            // ã‚µãƒ ãƒã‚¤ãƒ«ç”¨ãƒ‡ãƒ¼ã‚¿URLã‚’ç”Ÿæˆ
                            const thumbnailDataUrl = canvas.toDataURL('image/jpeg', quality);
                            resolve(thumbnailDataUrl);
                            
                        } catch (error) {
                            console.log('âš ï¸ Thumbnail generation failed:', error);
                            resolve(src); // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã§å…ƒç”»åƒã‚’ä½¿ç”¨
                        }
                    };
                    
                    img.onerror = () => {
                        console.log('âŒ Thumbnail image load failed');
                        resolve(src); // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã§å…ƒç”»åƒã‚’ä½¿ç”¨
                    };
                    
                    img.src = src;
                });
            }

            // æ‰‹å‹•ã§ãƒ•ã‚©ãƒ«ãƒ€ã‚’ãƒã‚§ãƒƒã‚¯ï¼ˆé–‹ç™ºæ™‚ç”¨ï¼‰
            async checkPhotoFolders() {
                console.log('ğŸ“ Photo folder structure:');
                console.log('   /photos/miiko/ <- ã¿ãƒ¼ã“ã®å†™çœŸã‚’ã“ã“ã«é…ç½®');
                console.log('   /photos/gallery/ <- ã‚®ãƒ£ãƒ©ãƒªãƒ¼å†™çœŸã‚’ã“ã“ã«é…ç½®');
                console.log('');
                console.log('ğŸ“„ Supported formats: .jpg, .jpeg, .png, .gif, .webp');
                console.log('ğŸ”§ Auto-resize: ANY size â†’ optimized display size');
                console.log('ğŸ“ Main photos: Auto-resized to 800x1200 (portrait)');
                console.log('ğŸ–¼ï¸ Gallery photos: Auto-resized to 300x200 (landscape)');
                console.log('ğŸ’¡ Tip: Upload any size - system handles optimization automatically!');
            }
        }

        // ğŸ“¤ ImageDropHandler Integration - ç®¡ç†è€…èªè¨¼ä»˜ããƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—æ©Ÿèƒ½
        class ImageDropHandler {
            constructor(photoManager) {
                this.photoManager = photoManager;
                this.isAdminMode = false;
                this.adminPassword = 'sogoods2024'; // æœ¬ç•ªã§ã¯å¤‰æ›´ã—ã¦ãã ã•ã„
                this.keySequence = [];
                this.secretKeys = ['s', 'o', 'g', 'o', 'o', 'd', 's']; // sogoods
                this.setupKeyListener();
                this.setupAuthSystem();
                this.checkDropPermission();
            }

            // ã‚­ãƒ¼ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ç›£è¦–ï¼ˆç°¡ç´ åŒ–ï¼‰
            setupKeyListener() {
                document.addEventListener('keydown', (e) => {
                    // ç§˜å¯†ã®ã‚­ãƒ¼ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ 'sogoods' ç›£è¦–ï¼ˆç·Šæ€¥ç”¨ï¼‰
                    this.keySequence.push(e.key.toLowerCase());
                    if (this.keySequence.length > this.secretKeys.length) {
                        this.keySequence.shift();
                    }

                    if (this.keySequence.join('') === this.secretKeys.join('')) {
                        console.log('ğŸ”‘ Emergency key sequence detected!');
                        this.showAdminPrompt();
                        this.keySequence = [];
                    }
                });
            }

            // ç®¡ç†è€…èªè¨¼ã‚·ã‚¹ãƒ†ãƒ 
            setupAuthSystem() {
                // ç®¡ç†è€…ãƒ¢ãƒ¼ãƒ‰è¡¨ç¤ºã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ã‚’è¿½åŠ 
                this.createAdminIndicator();
                
                // éš ã—ãƒ­ã‚°ã‚¤ãƒ³ãƒœã‚¿ãƒ³ã‚’è¿½åŠ 
                this.createHiddenLoginButton();
                
                // localStorage ã‹ã‚‰èªè¨¼çŠ¶æ…‹ã‚’å¾©å…ƒ
                const savedAuth = localStorage.getItem('sogoods_admin_session');
                if (savedAuth) {
                    const session = JSON.parse(savedAuth);
                    const now = new Date().getTime();
                    
                    // ã‚»ãƒƒã‚·ãƒ§ãƒ³ãŒ24æ™‚é–“ä»¥å†…ãªã‚‰è‡ªå‹•ãƒ­ã‚°ã‚¤ãƒ³
                    if (now - session.timestamp < 24 * 60 * 60 * 1000) {
                        this.isAdminMode = true;
                        this.updateAdminIndicator();
                        console.log('ğŸ” Admin session restored');
                    }
                }
            }

            // ç®¡ç†è€…ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆè¡¨ç¤º
            showAdminPrompt() {
                if (this.isAdminMode) {
                    // ã™ã§ã«ç®¡ç†è€…ãƒ¢ãƒ¼ãƒ‰ã®å ´åˆã¯ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ
                    this.logout();
                    return;
                }

                const password = prompt('ğŸ” ç®¡ç†è€…ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„:\n\nğŸ’¡ ãƒ’ãƒ³ãƒˆ: Ctrl+Shift+A ã¾ãŸã¯ "sogoods" ã‚­ãƒ¼ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ã§ã‚‚é–‹ã‘ã¾ã™');
                
                if (password === this.adminPassword) {
                    this.login();
                } else if (password !== null) {
                    alert('âŒ ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒé•ã„ã¾ã™');
                    console.log('ğŸš« Admin authentication failed');
                }
            }

            // ãƒ­ã‚°ã‚¤ãƒ³å‡¦ç†
            login() {
                this.isAdminMode = true;
                
                // ã‚»ãƒƒã‚·ãƒ§ãƒ³ä¿å­˜ï¼ˆ24æ™‚é–“ï¼‰
                const session = {
                    timestamp: new Date().getTime(),
                    user: 'admin'
                };
                localStorage.setItem('sogoods_admin_session', JSON.stringify(session));
                
                this.setupDropZones();
                this.updateAdminIndicator();
                
                console.log('âœ… Admin mode activated');
                console.log('ğŸ“¤ Drag & Drop enabled for photo upload');
                alert('âœ… ç®¡ç†è€…ãƒ¢ãƒ¼ãƒ‰ãŒæœ‰åŠ¹ã«ãªã‚Šã¾ã—ãŸï¼\nğŸ“¤ å†™çœŸã®ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—ãŒå¯èƒ½ã§ã™');
            }

            // ãƒ­ã‚°ã‚¢ã‚¦ãƒˆå‡¦ç†
            logout() {
                this.isAdminMode = false;
                localStorage.removeItem('sogoods_admin_session');
                
                this.removeDropZones();
                this.updateAdminIndicator();
                
                console.log('ğŸ”’ Admin mode deactivated');
                alert('ğŸ”’ ç®¡ç†è€…ãƒ¢ãƒ¼ãƒ‰ã‚’çµ‚äº†ã—ã¾ã—ãŸ');
            }

            // éš ã—ç®¡ç†è€…ãƒœã‚¿ãƒ³ã®ä½œæˆ
            createAdminIndicator() {
                // ãƒ¡ã‚¤ãƒ³ã®ç®¡ç†è€…ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤º
                const indicator = document.createElement('div');
                indicator.id = 'admin-indicator';
                indicator.style.cssText = `
                    position: fixed;
                    top: 10px;
                    right: 10px;
                    background: rgba(0,0,0,0.8);
                    color: white;
                    padding: 8px 12px;
                    border-radius: 20px;
                    font-size: 12px;
                    font-family: Arial, sans-serif;
                    z-index: 1000;
                    display: none;
                    cursor: pointer;
                    transition: all 0.3s ease;
                `;
                
                indicator.onclick = () => this.showAdminPrompt();
                document.body.appendChild(indicator);
                this.adminIndicator = indicator;
            }

            // éš ã—ãƒ­ã‚°ã‚¤ãƒ³ãƒœã‚¿ãƒ³ã®ä½œæˆ
            createHiddenLoginButton() {
                const hiddenButton = document.createElement('div');
                hiddenButton.id = 'hidden-admin-btn';
                hiddenButton.style.cssText = `
                    position: fixed;
                    bottom: 10px;
                    left: 10px;
                    width: 20px;
                    height: 20px;
                    background: rgba(200, 200, 200, 0.1);
                    border-radius: 50%;
                    cursor: pointer;
                    z-index: 1000;
                    transition: all 0.2s ease;
                    opacity: 0.1;
                    border: 1px solid rgba(200, 200, 200, 0.2);
                `;
                
                // ãƒ›ãƒãƒ¼æ™‚ã«å°‘ã—ç›®ç«‹ã¤ã‚ˆã†ã«
                hiddenButton.addEventListener('mouseenter', () => {
                    hiddenButton.style.opacity = '0.4';
                    hiddenButton.style.background = 'rgba(33, 150, 243, 0.3)';
                    hiddenButton.style.transform = 'scale(1.2)';
                });
                
                hiddenButton.addEventListener('mouseleave', () => {
                    hiddenButton.style.opacity = '0.1';
                    hiddenButton.style.background = 'rgba(200, 200, 200, 0.1)';
                    hiddenButton.style.transform = 'scale(1)';
                });
                
                // ã‚¯ãƒªãƒƒã‚¯ã§ç®¡ç†è€…ãƒ­ã‚°ã‚¤ãƒ³
                hiddenButton.addEventListener('click', () => {
                    this.showAdminPrompt();
                });
                
                // ãƒ€ãƒ–ãƒ«ã‚¯ãƒªãƒƒã‚¯ã§æ›´ã«ã‚ã‹ã‚Šã‚„ã™ã
                hiddenButton.addEventListener('dblclick', (e) => {
                    e.preventDefault();
                    hiddenButton.style.background = 'rgba(33, 150, 243, 0.8)';
                    setTimeout(() => {
                        hiddenButton.style.background = 'rgba(200, 200, 200, 0.1)';
                    }, 200);
                });
                
                // ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—ï¼ˆãƒ›ãƒãƒ¼æ™‚ã®ãƒ’ãƒ³ãƒˆï¼‰
                hiddenButton.title = 'Admin';
                
                document.body.appendChild(hiddenButton);
                this.hiddenButton = hiddenButton;
            }

            // ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿æ›´æ–°
            updateAdminIndicator() {
                if (!this.adminIndicator) return;
                
                // ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚¿ã‚¤ãƒ—ã®è¡¨ç¤º
                const storageType = this.photoManager.serverStorageEnabled ? 'ğŸ“ Server Storage' : 'ğŸ’¾ Browser Storage';
                
                if (this.isAdminMode) {
                    this.adminIndicator.innerHTML = `ğŸ”“ ç®¡ç†è€…ãƒ¢ãƒ¼ãƒ‰ (${storageType}) | ã‚¯ãƒªãƒƒã‚¯ã§ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ`;
                    this.adminIndicator.style.display = 'block';
                    this.adminIndicator.style.background = 'rgba(33, 150, 243, 0.9)';
                    
                    // éš ã—ãƒœã‚¿ãƒ³ã‚‚ç®¡ç†è€…ãƒ¢ãƒ¼ãƒ‰è¡¨ç¤ºã«
                    if (this.hiddenButton) {
                        this.hiddenButton.style.background = 'rgba(33, 150, 243, 0.4)';
                        this.hiddenButton.style.opacity = '0.6';
                        this.hiddenButton.title = `Admin (${storageType}) - Click to logout`;
                    }
                } else {
                    this.adminIndicator.innerHTML = `ğŸ” å·¦ä¸‹ã®éš ã—ãƒœã‚¿ãƒ³ã§ç®¡ç†è€…ãƒ­ã‚°ã‚¤ãƒ³ (${storageType})`;
                    this.adminIndicator.style.display = 'block';
                    this.adminIndicator.style.background = 'rgba(0,0,0,0.6)';
                    
                    // éš ã—ãƒœã‚¿ãƒ³ã‚’é€šå¸¸çŠ¶æ…‹ã«
                    if (this.hiddenButton) {
                        this.hiddenButton.style.background = 'rgba(200, 200, 200, 0.1)';
                        this.hiddenButton.style.opacity = '0.1';
                        this.hiddenButton.title = `Admin Login (${storageType})`;
                    }
                    
                    // 5ç§’å¾Œã«éè¡¨ç¤º
                    setTimeout(() => {
                        if (!this.isAdminMode) {
                            this.adminIndicator.style.display = 'none';
                        }
                    }, 3000);
                }
            }

            // ãƒ‰ãƒ­ãƒƒãƒ—æ¨©é™ãƒã‚§ãƒƒã‚¯
            checkDropPermission() {
                if (!this.isAdminMode) {
                    console.log('ğŸ”’ DropåŠŸèƒ½å·²ç¦ç”¨ - éœ€è¦ç®¡ç†å‘˜æƒé™');
                    return;
                }
                this.setupDropZones();
            }

            setupDropZones() {
                if (!this.isAdminMode) return;
                
                // ãƒ¡ã‚¤ãƒ³ç”»åƒã‚¨ãƒªã‚¢ã‚’ãƒ‰ãƒ­ãƒƒãƒ—ã‚¾ãƒ¼ãƒ³ã«
                const centerColumn = document.querySelector('.center-column');
                if (centerColumn) {
                    // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ãŒé‡è¤‡ã—ãªã„ã‚ˆã†ä¸€åº¦å‰Šé™¤
                    this.removeDropZones();
                    
                    // ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã‚’ãƒã‚¤ãƒ³ãƒ‰ã—ã¦ä¿å­˜
                    this.boundHandlers = {
                        dragOver: this.handleDragOver.bind(this),
                        drop: this.handleDrop.bind(this),
                        dragEnter: this.handleDragEnter.bind(this),
                        dragLeave: this.handleDragLeave.bind(this)
                    };
                    
                    // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’è¿½åŠ 
                    centerColumn.addEventListener('dragover', this.boundHandlers.dragOver);
                    centerColumn.addEventListener('drop', this.boundHandlers.drop);
                    centerColumn.addEventListener('dragenter', this.boundHandlers.dragEnter);
                    centerColumn.addEventListener('dragleave', this.boundHandlers.dragLeave);
                    
                    // è¦–è¦šçš„ãªç®¡ç†è€…ãƒ¢ãƒ¼ãƒ‰è¡¨ç¤º
                    centerColumn.style.position = 'relative';
                    
                    // ç®¡ç†è€…ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ã®è¿½åŠ 
                    if (!centerColumn.querySelector('.admin-overlay')) {
                        const overlay = document.createElement('div');
                        overlay.className = 'admin-overlay';
                        overlay.style.cssText = `
                            position: absolute;
                            top: 10px;
                            left: 10px;
                            background: rgba(33, 150, 243, 0.9);
                            color: white;
                            padding: 6px 10px;
                            border-radius: 12px;
                            font-size: 11px;
                            font-family: Arial, sans-serif;
                            z-index: 6;
                            pointer-events: none;
                        `;
                        overlay.textContent = 'ğŸ“¤ Admin: Drop enabled';
                        centerColumn.appendChild(overlay);
                    }
                    
                    console.log('âœ… Drop zones setup completed');
                }
            }

            removeDropZones() {
                const centerColumn = document.querySelector('.center-column');
                if (centerColumn) {
                    // æ—¢å­˜ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’å‰Šé™¤ï¼ˆã‚ˆã‚Šå®‰å…¨ãªæ–¹æ³•ï¼‰
                    if (this.boundHandlers) {
                        centerColumn.removeEventListener('dragover', this.boundHandlers.dragOver);
                        centerColumn.removeEventListener('drop', this.boundHandlers.drop);
                        centerColumn.removeEventListener('dragenter', this.boundHandlers.dragEnter);
                        centerColumn.removeEventListener('dragleave', this.boundHandlers.dragLeave);
                    }
                    
                    // ç®¡ç†è€…ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ã‚’å‰Šé™¤
                    const overlay = centerColumn.querySelector('.admin-overlay');
                    if (overlay) overlay.remove();
                    
                    // ã‚¹ã‚¿ã‚¤ãƒ«ãƒªã‚»ãƒƒãƒˆ
                    centerColumn.style.backgroundColor = '';
                }
            }

            handleDragOver(e) {
                e.preventDefault();
                e.dataTransfer.dropEffect = 'copy';
            }

            handleDragEnter(e) {
                if (!this.isAdminMode) {
                    console.log('ğŸ”’ Drop disabled - Admin login required');
                    return;
                }
                
                e.preventDefault();
                e.target.style.backgroundColor = 'rgba(33, 150, 243, 0.1)';
                console.log('ğŸ¯ Admin drop zone activated - ready for image upload');
            }

            handleDragLeave(e) {
                e.target.style.backgroundColor = '';
            }

            async handleDrop(e) {
                console.log('ğŸ¯ Drop event triggered!', {
                    isAdminMode: this.isAdminMode,
                    filesCount: e.dataTransfer?.files?.length || 0
                });
                
                if (!this.isAdminMode) {
                    console.log('ğŸ”’ Drop blocked - Admin authentication required');
                    alert('ğŸ”’ ç®¡ç†è€…èªè¨¼ãŒå¿…è¦ã§ã™\n\nCtrl+Shift+A ã¾ãŸã¯ "sogoods" ã¨å…¥åŠ›ã—ã¦ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ãã ã•ã„');
                    return;
                }

                e.preventDefault();
                e.target.style.backgroundColor = '';
                
                const files = Array.from(e.dataTransfer.files);
                const imageFiles = files.filter(file => file.type.startsWith('image/'));
                
                console.log('ğŸ“ Files analysis:', {
                    totalFiles: files.length,
                    imageFiles: imageFiles.length,
                    fileTypes: files.map(f => f.type)
                });
                
                if (imageFiles.length === 0) {
                    console.log('âŒ No image files found in drop');
                    alert('âŒ ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“\nå¯¾å¿œå½¢å¼: JPG, PNG, GIF, WebP');
                    return;
                }

                console.log(`ğŸ“¤ Admin processing ${imageFiles.length} dropped image(s)`);
                alert(`ğŸ“¤ ${imageFiles.length}æšã®ç”»åƒã‚’å‡¦ç†ä¸­...`);

                for (const file of imageFiles) {
                    await this.processDroppedImage(file);
                }
                
                alert('âœ… ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å®Œäº†ï¼æ–°ã—ã„å†™çœŸãŒãƒ©ãƒ³ãƒ€ãƒ è¡¨ç¤ºã«è¿½åŠ ã•ã‚Œã¾ã—ãŸã€‚');
                
                // ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å¾Œã€å°‘ã—å¾…ã£ã¦ã‹ã‚‰ãƒ©ãƒ³ãƒ€ãƒ è¡¨ç¤ºã‚’æ›´æ–°
                setTimeout(() => {
                    this.photoManager.displayRandomPhoto();
                }, 1000);
            }

            async processDroppedImage(file) {
                console.log(`ğŸ”„ Processing image: ${file.name} (${(file.size / 1024 / 1024).toFixed(2)}MB)`);
                
                // å¾“æ¥ã®ãƒ–ãƒ©ã‚¦ã‚¶ãƒ™ãƒ¼ã‚¹å‡¦ç†
                return new Promise((resolve) => {
                    const reader = new FileReader();
                    
                    reader.onload = (e) => {
                        console.log('ğŸ“– File read successfully, creating image...');
                        const img = new Image();
                        img.onload = () => {
                            console.log(`ğŸ–¼ï¸ Image loaded: ${img.width}x${img.height}`);
                            
                            // ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã•ã‚ŒãŸå†™çœŸã‚’ãƒ©ãƒ³ãƒ€ãƒ è¡¨ç¤ºã«è¿½åŠ 
                            this.photoManager.addUploadedPhoto(e.target.result, file.name);
                            
                            // è‡ªå‹•ãƒªã‚µã‚¤ã‚ºã—ã¦è¡¨ç¤º
                            const mainImage = document.querySelector('.main-image');
                            if (mainImage) {
                                this.photoManager.loadImageWithAutoResize(e.target.result, mainImage, {
                                    targetWidth: 800,
                                    targetHeight: 1200,
                                    quality: 0.8
                                });
                                
                                console.log(`âœ… Processed: ${file.name} (${img.width}x${img.height})`);
                            } else {
                                console.error('âŒ Main image element not found');
                            }
                            resolve();
                        };
                        
                        img.onerror = () => {
                            console.error(`âŒ Failed to load image: ${file.name}`);
                            resolve();
                        };
                        
                        img.src = e.target.result;
                    };
                    
                    reader.onerror = () => {
                        console.error(`âŒ Failed to read file: ${file.name}`);
                        resolve();
                    };
                    
                    reader.readAsDataURL(file);
                });
            }
        }

        // ã‚°ãƒ­ãƒ¼ãƒãƒ«ã«å…¬é–‹
        window.PhotoManager = PhotoManager;
        window.ImageDropHandler = ImageDropHandler;

        // ğŸ“ TankaSystem Integration - sogoods.net Advanced Tanka System
        /**
         * sogoods.net Advanced Tanka System
         * CSV Database Integration + Vertical Display + Voting System
         */

        class TankaSystem {
            constructor() {
                this.tankaDatabase = [];
                this.votingResults = new Map(); // tankaId -> {likes: 0, dislikes: 0}
                this.currentTankaIndex = 0;
                this.isInitialized = false;
                
                this.init();
            }

            async init() {
                console.log('ğŸ“ Initializing Advanced Tanka System...');
                
                try {
                    await this.loadTankaDatabase();
                    await this.loadVotingResults();
                    this.isInitialized = true;
                    console.log(`âœ… Tanka system ready with ${this.tankaDatabase.length} poems`);
                } catch (error) {
                    console.error('âŒ Tanka system initialization failed:', error);
                    this.fallbackToStaticTanka();
                }
            }

            // CSV ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’èª­ã¿è¾¼ã¿
            async loadTankaDatabase() {
                try {
                    const response = await fetch('/tankadb.csv');
                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}`);
                    }
                    
                    const csvText = await response.text();
                    this.tankaDatabase = this.parseCSV(csvText);
                    
                    console.log(`ğŸ“š Loaded ${this.tankaDatabase.length} tanka from CSV database`);
                    console.log('ğŸ“Š Sample tanka:', this.tankaDatabase.slice(0, 3));
                    
                } catch (error) {
                    console.error('âŒ Failed to load tanka CSV:', error);
                    throw error;
                }
            }

            // CSVãƒ‘ãƒ¼ã‚µãƒ¼
            parseCSV(csvText) {
                const lines = csvText.split('\n').filter(line => line.trim());
                const header = lines[0].split(',');
                const tanka = [];
                
                for (let i = 1; i < lines.length; i++) {
                    const columns = this.parseCSVLine(lines[i]);
                    if (columns.length >= 3) {
                        tanka.push({
                            id: i,
                            text: columns[0].trim(),
                            date: columns[1].trim(),
                            rating: parseInt(columns[2]) || 0,
                            votes: { likes: 0, dislikes: 0 }
                        });
                    }
                }
                
                return tanka;
            }

            // CSVè¡Œãƒ‘ãƒ¼ã‚µãƒ¼ï¼ˆã‚«ãƒ³ãƒãŒçŸ­æ­Œå†…ã«å«ã¾ã‚Œã‚‹å ´åˆã«å¯¾å¿œï¼‰
            parseCSVLine(line) {
                const result = [];
                let current = '';
                let inQuotes = false;
                
                for (let i = 0; i < line.length; i++) {
                    const char = line[i];
                    
                    if (char === '"') {
                        inQuotes = !inQuotes;
                    } else if (char === ',' && !inQuotes) {
                        result.push(current);
                        current = '';
                    } else {
                        current += char;
                    }
                }
                
                result.push(current);
                return result;
            }

            // æŠ•ç¥¨çµæœã‚’èª­ã¿è¾¼ã¿ï¼ˆã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰ï¼‰
            async loadVotingResults() {
                try {
                    const response = await fetch('/api/tanka-vote');
                    if (response.ok) {
                        const results = await response.json();
                        if (results.success) {
                            results.votes.forEach(vote => {
                                this.votingResults.set(vote.tankaId, {
                                    likes: vote.likes || 0,
                                    dislikes: vote.dislikes || 0
                                });
                            });
                            console.log(`ğŸ“Š Loaded voting results for ${this.votingResults.size} tanka`);
                        }
                    }
                } catch (error) {
                    console.log('âš ï¸ No voting results found (will start fresh)');
                }
            }

            // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ç”¨ã®é™çš„çŸ­æ­Œ
            fallbackToStaticTanka() {
                console.log('ğŸ”„ Using fallback static tanka collection');
                this.tankaDatabase = [
                    { id: 1, text: "å†¬ã®æœçª“è¾ºã«åº§ã‚‹çŒ«ã®ç³é™å¯‚ã‚’æ˜ ã—æ™‚ãŒæ­¢ã¾ã‚‹", date: "2024-01-01", rating: 4 },
                    { id: 2, text: "æ¡œæ•£ã‚Šé¢¨ã«èˆã„è¸Šã‚‹èŠ±ã³ã‚‰ã‚ˆå¿ƒã«æ®‹ã‚‹æ˜¥ã®è¨˜æ†¶", date: "2024-01-02", rating: 5 },
                    { id: 3, text: "å¤•æš®ã‚Œã«è¡—ç¯ãŒç‚¹ãé“ã™ãŒã‚‰å½±ãŒé•·ãã¦å®¶è·¯æ€¥ã", date: "2024-01-03", rating: 3 }
                ];
                this.isInitialized = true;
            }

            // ãƒ©ãƒ³ãƒ€ãƒ ãªçŸ­æ­Œã‚’å–å¾—
            getRandomTanka() {
                if (!this.isInitialized || this.tankaDatabase.length === 0) {
                    return null;
                }
                
                const randomIndex = Math.floor(Math.random() * this.tankaDatabase.length);
                this.currentTankaIndex = randomIndex;
                return this.tankaDatabase[randomIndex];
            }

            // ç¸¦æ›¸ãçŸ­æ­Œãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã‚’è¡¨ç¤º
            displayVerticalTanka(tankaData, element) {
                // æ—¢å­˜ã®ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã‚’å‰Šé™¤
                const existingPopup = document.querySelector('.tanka-popup');
                if (existingPopup) {
                    existingPopup.remove();
                }

                // ã‚¨ãƒ¢ãƒ¼ã‚·ãƒ§ãƒŠãƒ«ãªè§£èª¬ã‚’ç”Ÿæˆ
                const commentary = this.generateEmotionalCommentary(tankaData.text);

                const popup = document.createElement('div');
                popup.className = 'tanka-popup';
                popup.innerHTML = `
                    <div class="tanka-popup-content">
                        <div class="tanka-close-btn" onclick="this.closest('.tanka-popup').remove()">Ã—</div>
                        <div class="tanka-vertical-text">${this.createVerticalText(tankaData.text)}</div>
                        <div class="tanka-commentary">
                            ${commentary}
                        </div>
                        <div class="tanka-voting">
                            <button class="vote-btn like-btn" onclick="window.tankaSystem.voteTanka(${tankaData.id}, 'like', this)">
                                ğŸ‘ ã„ã„ã­ <span class="vote-count">${this.getVotes(tankaData.id).likes}</span>
                            </button>
                            <button class="vote-btn dislike-btn" onclick="window.tankaSystem.voteTanka(${tankaData.id}, 'dislike', this)">
                                ğŸ‘ ã†ã€œã‚“ <span class="vote-count">${this.getVotes(tankaData.id).dislikes}</span>
                            </button>
                        </div>
                    </div>
                    <div class="tanka-popup-overlay" onclick="this.closest('.tanka-popup').remove()"></div>
                `;

                document.body.appendChild(popup);

                // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
                requestAnimationFrame(() => {
                    popup.classList.add('show');
                });

                console.log(`ğŸ“ Displaying tanka with commentary: "${tankaData.text.substring(0, 20)}..."`);
            }

            // æœ¨ä¸‹é¾ä¹Ÿãƒ»ä¿µä¸‡æ™ºã‚¹ã‚¿ã‚¤ãƒ«ã®ã‚¨ãƒ¢ãƒ¼ã‚·ãƒ§ãƒŠãƒ«ãªè§£èª¬ã‚’ç”Ÿæˆ
            generateEmotionalCommentary(tankaText) {
                console.log(`ğŸ” Analyzing tanka: "${tankaText}"`);
                
                // ã‚ˆã‚Šä¸€èˆ¬çš„ãªãƒ†ãƒ¼ãƒãƒ‘ã‚¿ãƒ¼ãƒ³
                const generalPatterns = [
                    {
                        pattern: /ç¬‘.*ä¸æ€è­°|ãµã—ã.*ç¬‘/,
                        style: "ç¬‘ã„ã®ä¸æ€è­°ã•ã€‚ãªãœãã®ç¬é–“ã«ç¬‘ã¿ãŒã“ã¼ã‚Œã‚‹ã®ã‹ã€ç†ç”±ã¯ã‚ã‹ã‚‰ãªã„ã‘ã‚Œã©ç¢ºã‹ã«ã‚ã‚‹æ¸©ã‹ã•ã€‚"
                    },
                    {
                        pattern: /ç¥.*å‚ã‚Š|ã‹ã¿ã•ã¾.*ãã‚‚ã¡/,
                        style: "ç¥æ§˜ã«å‘ãåˆã†æ™‚ã®ã€è¨€è‘‰ã«ãªã‚‰ãªã„æ°—æŒã¡ã€‚ç†å±ˆã˜ã‚ƒãªã„ã€å¿ƒã®å¥¥åº•ã‹ã‚‰ã®ç´ ç›´ãªæ€ã„ã€‚"
                    },
                    {
                        pattern: /å­.*é«ª.*ãªã§|ã•ã‚€ã—ã„.*å­/,
                        style: "å­ã©ã‚‚ã¸ã®å„ªã—ã•ãŒã€é«ªã‚’ãªã§ã‚‹æ‰‹ã®ã²ã‚‰ã«è¾¼ã‚ã‚‰ã‚Œã¦ã„ã‚‹ã€‚è¨€è‘‰ä»¥ä¸Šã«ä¼ã‚ã‚‹æ„›æƒ…ã€‚"
                    },
                    {
                        pattern: /ç”Ÿãã‚‹.*ä¿¡ã˜ã‚‹/,
                        style: "ç”Ÿãã‚‹ã“ã¨ã¨ä¿¡ã˜ã‚‹ã“ã¨ã€‚ã“ã®äºŒã¤ã¯åˆ‡ã£ã¦ã‚‚åˆ‡ã‚Œãªã„é–¢ä¿‚ã€‚ä¿¡ã˜ã‚‹åŠ›ãŒã‚ã‚‹ã‹ã‚‰ç”Ÿãã¦ã„ã‘ã‚‹ã€‚"
                    },
                    {
                        pattern: /èŠ½.*èŠ±.*è‚²ã¦/,
                        style: "ä»Šã¯å°ã•ãªèŠ½ã§ã‚‚ã€å¤§åˆ‡ã«è‚²ã¦ã‚Œã°ã„ã¤ã‹èŠ±ã‚’å’²ã‹ã›ã‚‹ã€‚æˆé•·ã¸ã®å¸Œæœ›ã¨æ„›æƒ…ã€‚"
                    },
                    {
                        pattern: /å¤¢.*æ¥½ã—.*é“/,
                        style: "å¤¢ã¸ã®é“ã®ã‚Šã‚’æ¥½ã—ã‚€å¿ƒã€‚ç›®çš„åœ°ã‚ˆã‚Šã‚‚ã€æ­©ã„ã¦ã„ã‚‹ä»Šã“ã®æ™‚é–“ã‚’å¤§åˆ‡ã«ã™ã‚‹ç”Ÿãæ–¹ã€‚"
                    },
                    {
                        pattern: /å†¬.*æ˜¥.*ã»ã—ã„/,
                        style: "å³ã—ã„å†¬ã‚’çµŒé¨“ã—ãŸã‹ã‚‰ã“ãã€æ˜¥ã¸ã®æ†§ã‚ŒãŒæ·±ã„ã€‚å›°é›£ã®å¾Œã«æ¥ã‚‹å¸Œæœ›ã¸ã®åˆ‡å®Ÿãªé¡˜ã„ã€‚"
                    },
                    {
                        pattern: /çª“.*é›¨.*æ°´|é›¨.*ã¾ã‹ã›ã‚‹/,
                        style: "çª“è¾ºã®é›¨ã‚’è¦‹ã¤ã‚ã‚‹æ™‚é–“ã€‚è‡ªç„¶ã«èº«ã‚’ä»»ã›ã‚‹å¿ƒã®é™ã‘ã•ã€‚ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã§ããªã„ã‚‚ã®ã¸ã®ä¿¡é ¼ã€‚"
                    }
                ];

                // ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ãƒã‚§ãƒƒã‚¯
                for (let pattern of generalPatterns) {
                    if (pattern.pattern.test(tankaText)) {
                        console.log(`âœ… Matched pattern: ${pattern.pattern}`);
                        return pattern.style;
                    }
                }

                // ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãƒ™ãƒ¼ã‚¹ã®è§£èª¬ç”Ÿæˆ
                return this.generateKeywordBasedCommentary(tankaText);
            }

            // ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãƒ™ãƒ¼ã‚¹ã®è§£èª¬ç”Ÿæˆ
            generateKeywordBasedCommentary(tankaText) {
                const keywords = [];
                
                // æ„Ÿæƒ…ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰
                if (/å¬‰ã—|æ¥½ã—|å¹¸ã›|ã‚ˆã‚ã“/.test(tankaText)) keywords.push('joy');
                if (/æ‚²ã—|æ³£|æ¶™|è¾›|è‹¦ã—/.test(tankaText)) keywords.push('sadness');
                if (/æ„›|æ‹|å¥½ã|æ‹äºº/.test(tankaText)) keywords.push('love');
                if (/ä¸å®‰|å¿ƒé…|æ€–|æ/.test(tankaText)) keywords.push('anxiety');
                if (/æ‡ã‹ã—|æ€ã„å‡º|æ˜”/.test(tankaText)) keywords.push('nostalgia');
                
                // è‡ªç„¶ãƒ»å­£ç¯€ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰
                if (/æ˜¥|æ¡œ|èŠ±|èŠ½/.test(tankaText)) keywords.push('spring');
                if (/å¤|æš‘|æµ·|é™½/.test(tankaText)) keywords.push('summer');
                if (/ç§‹|ç´…è‘‰|é¢¨|è½ã¡è‘‰/.test(tankaText)) keywords.push('autumn');
                if (/å†¬|é›ª|å¯’|æ°·/.test(tankaText)) keywords.push('winter');
                if (/é›¨|é›²|ç©º|è™¹/.test(tankaText)) keywords.push('weather');
                
                // äººé–“é–¢ä¿‚ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰
                if (/å®¶æ—|æ¯|çˆ¶|å­|è¦ª/.test(tankaText)) keywords.push('family');
                if (/å‹|ä»²é–“|ã¿ã‚“ãª/.test(tankaText)) keywords.push('friendship');
                if (/ä¸€äºº|ç‹¬ã‚Š|å­¤ç‹¬|ã²ã¨ã‚Š/.test(tankaText)) keywords.push('solitude');
                
                // æ™‚é–“ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰
                if (/éå»|æ˜”|æ€ã„å‡º|å‰/.test(tankaText)) keywords.push('past');
                if (/æœªæ¥|æ˜æ—¥|å¸Œæœ›|å°†æ¥/.test(tankaText)) keywords.push('future');
                if (/ä»Š|ç¬é–“|ç¾åœ¨|ã„ã¾/.test(tankaText)) keywords.push('present');

                // ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã«åŸºã¥ã„ãŸè§£èª¬
                const commentaryMap = {
                    joy: "ã“ã®æ­Œã«è¾¼ã‚ã‚‰ã‚ŒãŸå–œã³ãŒã€èª­ã‚€äººã®å¿ƒã‚‚æ˜ã‚‹ãã—ã¦ãã‚Œã‚‹ã€‚å¹¸ã›ã£ã¦ã€ã“ã†ã‚„ã£ã¦äººã‹ã‚‰äººã¸ä¼ã‚ã£ã¦ã„ãã‚‚ã®ã€‚",
                    sadness: "æ‚²ã—ã¿ã‚’ä¸å¯§ã«è¨€è‘‰ã«ã™ã‚‹ã“ã¨ã§ã€ãã®æ„Ÿæƒ…ã«å‘ãåˆãŠã†ã¨ã™ã‚‹å¼·ã•ã‚’æ„Ÿã˜ã‚‹ã€‚æ¶™ã®å‘ã“ã†å´ã«ã‚ã‚‹å¸Œæœ›ã€‚",
                    love: "æ„›æƒ…ã‚’çŸ­æ­Œã«è¾¼ã‚ã‚‹æ™‚ã®ã€ãã®äººã¸ã®æƒ³ã„ã®æ·±ã•ã€‚è¨€è‘‰ã‚’é¸ã¶ä¸€ã¤ä¸€ã¤ã«ã€æ„›ãŒå®¿ã£ã¦ã„ã‚‹ã€‚",
                    anxiety: "ä¸å®‰ãªæ°—æŒã¡ã‚‚ã€ã“ã†ã—ã¦æ­Œã«ã™ã‚‹ã“ã¨ã§å°‘ã—è»½ããªã‚‹ã€‚ä¸€äººã˜ã‚ƒãªã„ã‚ˆã€ã¨ã„ã†å£°ãŒèã“ãˆã¦ãã‚‹ã€‚",
                    nostalgia: "æ‡ã‹ã—ã•ã«åŒ…ã¾ã‚ŒãªãŒã‚‰ã€éå»ã®è‡ªåˆ†ã¨ä»Šã®è‡ªåˆ†ãŒå¯¾è©±ã—ã¦ã„ã‚‹ã€‚æ™‚é–“ã‚’è¶…ãˆãŸå¿ƒã®äº¤æµã€‚",
                    spring: "æ˜¥ã®è¨ªã‚Œã‚’å¿ƒã§æ„Ÿã˜å–ã‚‹ç¹Šç´°ã•ã€‚æ–°ã—ã„å­£ç¯€ã¸ã®æœŸå¾…ã¨å¸Œæœ›ãŒã€è¨€è‘‰ã®ç«¯ã€…ã«ç¾ã‚Œã¦ã„ã‚‹ã€‚",
                    family: "å®¶æ—ã¸ã®æ„›æƒ…ãŒã€ä½•æ°—ãªã„æ—¥å¸¸ã®æå†™ã«è¾¼ã‚ã‚‰ã‚Œã¦ã„ã‚‹ã€‚å½“ãŸã‚Šå‰ã®å¹¸ã›ã‚’å¤§åˆ‡ã«ã™ã‚‹å¿ƒã€‚",
                    solitude: "ä¸€äººã®æ™‚é–“ã ã‹ã‚‰ã“ãè¦‹ãˆã¦ãã‚‹æ™¯è‰²ãŒã‚ã‚‹ã€‚å­¤ç‹¬ã®ä¸­ã«ã‚ã‚‹è±Šã‹ã•ã‚’ç™ºè¦‹ã™ã‚‹çœ¼å·®ã—ã€‚",
                    present: "ä»Šã“ã®ç¬é–“ã‚’å¤§åˆ‡ã«æ‰ãˆã‚‹æ°—æŒã¡ã€‚éãå»ã£ã¦ã—ã¾ã†æ™‚é–“ã¸ã®æ„›ãŠã—ã•ã€‚"
                };

                if (keywords.length > 0) {
                    const primaryKeyword = keywords[0];
                    console.log(`ğŸ¯ Generated commentary based on keyword: ${primaryKeyword}`);
                    return commentaryMap[primaryKeyword] || this.getDefaultCommentary();
                }

                return this.getDefaultCommentary();
            }

            // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè§£èª¬
            getDefaultCommentary() {
                const defaults = [
                    "çŸ­ã„è¨€è‘‰ã®ä¸­ã«ã€æ·±ã„æƒ³ã„ãŒè¾¼ã‚ã‚‰ã‚Œã¦ã„ã‚‹ã€‚èª­ã‚€ãŸã³ã«æ–°ã—ã„ç™ºè¦‹ãŒã‚ã‚‹ã€ãã‚“ãªä¸€é¦–ã€‚",
                    "æ—¥å¸¸ã®ä¸­ã®å°ã•ãªæ°—ã¥ãã‚’ã€å¤§åˆ‡ã«è¨€è‘‰ã«è¾¼ã‚ãŸæ­Œã€‚ä½œè€…ã®å„ªã—ã„çœ¼å·®ã—ãŒæ„Ÿã˜ã‚‰ã‚Œã‚‹ã€‚",
                    "ã“ã®æ­Œã‚’èª­ã‚“ã§ã„ã‚‹ã¨ã€è‡ªåˆ†ã®ä½“é¨“ã¨é‡ãªã‚‹éƒ¨åˆ†ãŒã‚ã£ã¦ã€å¿ƒãŒå‹•ã‹ã•ã‚Œã‚‹ã€‚",
                    "è¨€è‘‰ã¨è¨€è‘‰ã®é–“ã«ã‚ã‚‹ä½™ç™½ã«ã€èª­ã¿æ‰‹ã®æƒ³åƒãŒåºƒãŒã£ã¦ã„ãã€‚çŸ­æ­Œã®é­…åŠ›ã‚’æ„Ÿã˜ã‚‹ä¸€é¦–ã€‚",
                    "ä½œè€…ã®å¿ƒã®å‹•ããŒã€ãã®ã¾ã¾èª­ã¿æ‰‹ã«ä¼ã‚ã£ã¦ãã‚‹ã€‚ç´ ç›´ãªæ„Ÿæƒ…è¡¨ç¾ãŒå°è±¡çš„ã€‚"
                ];
                
                return defaults[Math.floor(Math.random() * defaults.length)];
            }

            // ç¸¦æ›¸ããƒ†ã‚­ã‚¹ãƒˆã‚’ç”Ÿæˆ
            createVerticalText(text) {
                const characters = text.split('');
                return characters.map(char => `<span class="vertical-char">${char}</span>`).join('');
            }

            // æŠ•ç¥¨æ•°ã‚’å–å¾—
            getVotes(tankaId) {
                return this.votingResults.get(tankaId) || { likes: 0, dislikes: 0 };
            }

            // çŸ­æ­Œã«æŠ•ç¥¨
            async voteTanka(tankaId, voteType, buttonElement) {
                try {
                    console.log(`ğŸ“Š Voting for tanka ${tankaId}: ${voteType}`);

                    const response = await fetch('/api/tanka-vote', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            tankaId: tankaId,
                            vote: voteType
                        })
                    });

                    if (response.ok) {
                        const result = await response.json();
                        if (result.success) {
                            // ãƒ­ãƒ¼ã‚«ãƒ«æŠ•ç¥¨çµæœã‚’æ›´æ–°
                            this.votingResults.set(tankaId, result.votes);
                            
                            // UI ã‚’æ›´æ–°
                            this.updateVotingUI(tankaId);
                            
                            // è¦–è¦šçš„ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯
                            buttonElement.classList.add('voted');
                            setTimeout(() => {
                                buttonElement.classList.remove('voted');
                            }, 300);

                            console.log(`âœ… Vote recorded: ${voteType} for tanka ${tankaId}`);
                        } else {
                            throw new Error(result.error);
                        }
                    } else {
                        throw new Error(`Server error: ${response.status}`);
                    }

                } catch (error) {
                    console.error('âŒ Vote failed:', error);
                    alert('æŠ•ç¥¨ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ã‚‚ã†ä¸€åº¦ãŠè©¦ã—ãã ã•ã„ã€‚');
                }
            }

            // æŠ•ç¥¨UI ã‚’æ›´æ–°
            updateVotingUI(tankaId) {
                const popup = document.querySelector('.tanka-popup');
                if (!popup) return;

                const votes = this.getVotes(tankaId);
                const likesCount = popup.querySelector('.like-btn .vote-count');
                const dislikesCount = popup.querySelector('.dislike-btn .vote-count');

                if (likesCount) likesCount.textContent = votes.likes;
                if (dislikesCount) dislikesCount.textContent = votes.dislikes;
            }

            // çµ±è¨ˆæƒ…å ±ã‚’å–å¾—
            getStats() {
                return {
                    totalTanka: this.tankaDatabase.length,
                    totalVotes: Array.from(this.votingResults.values()).reduce((sum, votes) => sum + votes.likes + votes.dislikes, 0),
                    mostLiked: this.getMostLikedTanka(),
                    averageRating: this.getAverageRating()
                };
            }

            getMostLikedTanka() {
                let maxLikes = 0;
                let mostLiked = null;

                this.votingResults.forEach((votes, tankaId) => {
                    if (votes.likes > maxLikes) {
                        maxLikes = votes.likes;
                        mostLiked = this.tankaDatabase.find(t => t.id === tankaId);
                    }
                });

                return mostLiked;
            }

            getAverageRating() {
                if (this.tankaDatabase.length === 0) return 0;
                const sum = this.tankaDatabase.reduce((total, tanka) => total + tanka.rating, 0);
                return (sum / this.tankaDatabase.length).toFixed(1);
            }
        }

        // ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹
        window.tankaSystem = new TankaSystem();

        // æ•°å­—ã®ãƒ©ãƒ³ãƒ€ãƒ ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚·ã‚¹ãƒ†ãƒ 
        class NumberAnimationSystem {
            constructor() {
                this.numbers = document.querySelectorAll('.number');
                this.animationIntervals = [];
                this.init();
            }

            init() {
                console.log('ğŸ”¢ Number Animation System initialized');
                this.startRandomAnimations();
            }

            startRandomAnimations() {
                this.numbers.forEach((number, index) => {
                    // å„æ•°å­—ã«ç•°ãªã‚‹ãƒ©ãƒ³ãƒ€ãƒ é–“éš”ã‚’è¨­å®šï¼ˆã‚ˆã‚Šã‚†ã£ãã‚Šï¼‰
                    const randomDelay = Math.random() * 15000; // 0-15ç§’ã®ãƒ©ãƒ³ãƒ€ãƒ åˆæœŸé…å»¶
                    const animationInterval = 10000 + Math.random() * 25000; // 10-35ç§’ã®ãƒ©ãƒ³ãƒ€ãƒ é–“éš”

                    setTimeout(() => {
                        this.animateNumber(number, index);
                        
                        // ç¶™ç¶šçš„ãªãƒ©ãƒ³ãƒ€ãƒ ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
                        const interval = setInterval(() => {
                            this.animateNumber(number, index);
                        }, animationInterval);
                        
                        this.animationIntervals.push(interval);
                    }, randomDelay);
                });
            }

            animateNumber(number, index) {
                // ã‚†ã£ãã‚Šã—ãŸæµ®ä¸Šã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
                number.style.animation = 'numberFloat 2.5s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards';
                
                // è¡¨ç¤ºæ™‚é–“ï¼ˆ5-10ç§’ã®ãƒ©ãƒ³ãƒ€ãƒ ï¼‰
                const displayTime = 5000 + Math.random() * 5000;
                
                setTimeout(() => {
                    // ã‚†ã£ãã‚Šã—ãŸæ¶ˆå¤±ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
                    number.style.animation = 'numberFade 3s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards';
                    
                    setTimeout(() => {
                        number.style.animation = '';
                    }, 3000);
                }, displayTime);

                console.log(`ğŸ’« Number ${index + 1} slowly animated`);
            }
        }

        // ãƒ¡ã‚¤ãƒ³ç”»åƒç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ï¼ˆç°¡ç´ åŒ–ç‰ˆï¼‰
        class MainImageSystem {
            constructor() {
                this.mainImages = [
                    '129-DSCN9004.JPG',
                    '1758928793445-2D3DD0DA-ABA9-44F8-B090-558ADB3E9F42.jpeg',
                    '1758932572782-032-DSC_1023.JPG.jpg',
                    '21-DSC_2098.JPG',
                    '30-DSC_8602.JPG'
                ];
                this.baseUrl = 'https://sogoods.net/photos/main/';
                this.mainImageElement = document.getElementById('main-image');
                this.fallbackImages = [
                    'https://images.unsplash.com/photo-1533738363-b7f9aef128ce?w=800&h=600&fit=crop',
                    'https://images.unsplash.com/photo-1583336663277-620dc1996580?w=800&h=600&fit=crop',
                    'https://images.unsplash.com/photo-1571566882372-1598d88abd90?w=800&h=600&fit=crop'
                ];
                this.init();
            }

            init() {
                console.log('ğŸ–¼ï¸ Main Image System initialized');
                this.displayRandomImage();
                
                // 30ç§’ã”ã¨ã«ç”»åƒã‚’å¤‰æ›´
                setInterval(() => {
                    this.displayRandomImage();
                }, 30000);
            }

            async displayRandomImage() {
                if (!this.mainImageElement) {
                    console.warn('âš ï¸ Main image element not found');
                    return;
                }

                const randomIndex = Math.floor(Math.random() * this.mainImages.length);
                const selectedImage = this.mainImages[randomIndex];
                const imageUrl = this.baseUrl + selectedImage;

                try {
                    // ç”»åƒã®èª­ã¿è¾¼ã¿ã‚’ãƒ†ã‚¹ãƒˆ
                    const img = new Image();
                    img.onload = () => {
                        this.mainImageElement.src = imageUrl;
                        this.mainImageElement.alt = `sogoods photo`;
                        this.mainImageElement.style.display = 'block';
                        console.log(`âœ… Main image loaded: ${selectedImage}`);
                    };
                    
                    img.onerror = () => {
                        console.warn(`âŒ Failed to load: ${selectedImage}, using fallback`);
                        this.useFallbackImage();
                    };
                    
                    img.src = imageUrl;
                    
                } catch (error) {
                    console.error('âŒ Image loading error:', error);
                    this.useFallbackImage();
                }
            }

            useFallbackImage() {
                const fallbackIndex = Math.floor(Math.random() * this.fallbackImages.length);
                const fallbackUrl = this.fallbackImages[fallbackIndex];
                
                this.mainImageElement.src = fallbackUrl;
                this.mainImageElement.alt = 'sogoods fallback image';
                this.mainImageElement.style.display = 'block';
                console.log(`ğŸ”„ Using fallback image: ${fallbackUrl}`);
            }
        }

        // DOMèª­ã¿è¾¼ã¿å¾Œã«è‡ªå‹•åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', () => {
            window.photoManager = new PhotoManager();
            window.imageDropHandler = new ImageDropHandler(window.photoManager);
            window.numberAnimationSystem = new NumberAnimationSystem();
            window.mainImageSystem = new MainImageSystem();
            
            // é–‹ç™ºæ™‚ã®ãƒ˜ãƒ«ãƒ—è¡¨ç¤º
            setTimeout(() => {
                window.photoManager.checkPhotoFolders();
                console.log('');
                console.log('ğŸ” ADMIN ACCESS:');
                console.log('   â€¢ Hidden button: Bottom-left corner (subtle gray circle)');
                console.log('   â€¢ Emergency: Type "sogoods" for backup access');
                console.log('   â€¢ Password: sogoods2024');
                console.log('   â€¢ Session: 24-hour auto-login after authentication');
                console.log('ğŸ“± Auto-resize: Upload ANY size - system optimizes automatically');
                console.log('ğŸ”’ Security: Only authenticated admins can upload photos');
            }, 2000);
        });
    </script>
</body>
</html>